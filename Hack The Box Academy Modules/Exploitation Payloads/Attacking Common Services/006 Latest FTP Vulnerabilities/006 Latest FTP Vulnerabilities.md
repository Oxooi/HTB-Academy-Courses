
<h1>Latest FTP Vulnerabilities</h1>
<hr/>
<p>In discussing the latest vulnerabilities, we will focus this section and the following ones on one of the previously shown attacks and present it as simply as possible without going into too much technical detail. This should help us facilitate the concept of the attack through an example related to a specific service to gain a better understanding.</p>
<p>In this case, we will discuss the <code>CoreFTP before build 727</code> vulnerability assigned <a href="https://nvd.nist.gov/vuln/detail/CVE-2022-22836">CVE-2022-22836</a>. This vulnerability is for an FTP service that does not correctly process the <code>HTTP PUT</code> request and leads to an <code>authenticated directory</code>/<code>path traversal,</code> and <code>arbitrary file write</code> vulnerability. This vulnerability allows us to write files outside the directory to which the service has access.</p>
<hr/>
<h2>The Concept of the Attack</h2>
<p>This FTP service uses an HTTP <code>POST</code> request to upload files. However, the CoreFTP service allows an HTTP <code>PUT</code> request, which we can use to write content to files. Let's have a look at the attack based on our concept. The <a href="https://www.exploit-db.com/exploits/50652">exploit</a> for this attack is relatively straightforward, based on a single <code>cURL</code> command.</p>
<h4>CoreFTP Exploitation</h4>
<pre><code class="language-shell-session">[!bash!]$ curl -k -X PUT -H "Host: &lt;IP&gt;" --basic -u &lt;username&gt;:&lt;password&gt; --data-binary "PoC." --path-as-is https://&lt;IP&gt;/../../../../../../whoops
</code></pre>
<p>We create a raw HTTP <code>PUT</code> request (<code>-X PUT</code>) with basic auth (<code>--basic -u &lt;username&gt;:&lt;password&gt;</code>), the path for the file (<code>--path-as-is https://&lt;IP&gt;/../../../../../whoops</code>), and its content (<code>--data-binary "PoC."</code>) with this command. Additionally, we specify the host header (<code>-H "Host: &lt;IP&gt;"</code>) with the IP address of our target system.</p>
<h4>The Concept of Attacks</h4>
<p><img alt="" src="https://academy.hackthebox.com/storage/modules/116/attack_concept2.png"/></p>
<p>In short, the actual process misinterprets the user's input of the path. This leads to access to the restricted folder being bypassed. As a result, the write permissions on the HTTP <code>PUT</code> request are not adequately controlled, which leads to us being able to create the files we want outside of the authorized folders. However, we will skip the explanation of the <code>Basic Auth</code> process and jump directly to the first part of the exploit.</p>
<h4>Directory Traversal</h4>
<table>
<thead>
<tr>
<th><strong>Step</strong></th>
<th><strong>Directory Traversal</strong></th>
<th><strong>Concept of Attacks - Category</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>1.</code></td>
<td>The user specifies the type of HTTP request with the file's content, including escaping characters to break out of the restricted area.</td>
<td><code>Source</code></td>
</tr>
<tr>
<td><code>2.</code></td>
<td>The changed type of HTTP request, file contents, and path entered by the user are taken over and processed by the process.</td>
<td><code>Process</code></td>
</tr>
<tr>
<td><code>3.</code></td>
<td>The application checks whether the user is authorized to be in the specified path. Since the restrictions only apply to a specific folder, all permissions granted to it are bypassed as it breaks out of that folder using the directory traversal.</td>
<td><code>Privileges</code></td>
</tr>
<tr>
<td><code>4.</code></td>
<td>The destination is another process that has the task of writing the specified contents of the user on the local system.</td>
<td><code>Destination</code></td>
</tr>
</tbody>
</table>
<p>Up to this point, we have bypassed the constraints imposed by the application using the escape characters (<code>../../../../</code>) and come to the second part, where the process writes the contents we specify to a file of our choice. This is when the cycle starts all over again, but this time to write contents to the target system.</p>
<h4>Arbitrary File Write</h4>
<table>
<thead>
<tr>
<th><strong>Step</strong></th>
<th><strong>Arbitrary File Write</strong></th>
<th><strong>Concept of Attacks - Category</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>5.</code></td>
<td>The same information that the user entered is used as the source. In this case, the filename (<code>whoops</code>) and the contents (<code>--data-binary "PoC."</code>).</td>
<td><code>Source</code></td>
</tr>
<tr>
<td><code>6.</code></td>
<td>The process takes the specified information and proceeds to write the desired content to the specified file.</td>
<td><code>Process</code></td>
</tr>
<tr>
<td><code>7.</code></td>
<td>Since all restrictions were bypassed during the directory traversal vulnerability, the service approves writing the contents to the specified file.</td>
<td><code>Privileges</code></td>
</tr>
<tr>
<td><code>8.</code></td>
<td>The filename specified by the user (<code>whoops</code>) with the desired content (<code>"PoC."</code>) now serves as the destination on the local system.</td>
<td><code>Destination</code></td>
</tr>
</tbody>
</table>
<p>After the task has been completed, we will be able to find this file with the corresponding contents on the target system.</p>
<h4>Target System</h4>
<pre><code class="language-cmd-session">C:\&gt; type C:\whoops

PoC.
</code></pre>
