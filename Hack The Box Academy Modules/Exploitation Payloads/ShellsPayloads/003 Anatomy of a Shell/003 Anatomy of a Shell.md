
<h1>Anatomy of a Shell</h1>
<hr/>
<p>Every operating system has a shell, and to interact with it, we must use an application known as a <code>terminal emulator</code>. Here are some of the most common terminal emulators:</p>
<table>
<thead>
<tr>
<th align="left"><strong>Terminal Emulator</strong></th>
<th align="left"><strong>Operating System</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a href="https://github.com/microsoft/terminal">Windows Terminal</a></td>
<td align="left">Windows</td>
</tr>
<tr>
<td align="left"><a href="https://cmder.app">cmder</a></td>
<td align="left">Windows</td>
</tr>
<tr>
<td align="left"><a href="https://www.putty.org">PuTTY</a></td>
<td align="left">Windows</td>
</tr>
<tr>
<td align="left"><a href="https://sw.kovidgoyal.net/kitty/">kitty</a></td>
<td align="left">Windows, Linux and MacOS</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/alacritty/alacritty">Alacritty</a></td>
<td align="left">Windows, Linux and MacOS</td>
</tr>
<tr>
<td align="left"><a href="https://invisible-island.net/xterm/">xterm</a></td>
<td align="left">Linux</td>
</tr>
<tr>
<td align="left"><a href="https://en.wikipedia.org/wiki/GNOME_Terminal">GNOME Terminal</a></td>
<td align="left">Linux</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/mate-desktop/mate-terminal">MATE Terminal</a></td>
<td align="left">Linux</td>
</tr>
<tr>
<td align="left"><a href="https://konsole.kde.org">Konsole</a></td>
<td align="left">Linux</td>
</tr>
<tr>
<td align="left"><a href="https://en.wikipedia.org/wiki/Terminal_(macOS)">Terminal</a></td>
<td align="left">MacOS</td>
</tr>
<tr>
<td align="left"><a href="https://iterm2.com">iTerm2</a></td>
<td align="left">MacOS</td>
</tr>
</tbody>
</table>
<p>This list is by no means every terminal emulator available, but it does include some noteworthy ones. Also, because many of these tools are open-source, we can install them on different operating systems in ways that may differ from the developers' original intentions. However, that is a project beyond the scope of this module. Selecting the proper terminal emulator for the job is primarily a personal and stylistic preference based on our workflows that develop as we get familiar with our OS of choice. So don't let anyone make you feel bad for selecting one option over the other. The terminal emulator we interact with on targets will essentially be dependant on what exists on the system natively.</p>
<hr/>
<h2>Command Language Interpreters</h2>
<p>Much like a human language interpreter will translate spoken or sign language in real-time, a <code>command language interpreter</code> is a program working to interpret the instructions provided by the user and issue the tasks to the operating system for processing. So when we discuss command-line interfaces, we know it is a combination of the operating system, terminal emulator application, and the command language interpreter. Many different command language interpreters can be used, some of which are also called <code>shell scripting languages</code> or <code>Command and Scripting interpreters</code> as defined in the <a href="https://attack.mitre.org/techniques/T1059/">Execution techniques</a> of the <code>MITRE ATT&amp;CK Matrix</code>. We do not need to be software developers to understand these concepts, but the more we know, the more success we can have when attempting to exploit vulnerable systems to gain a shell session.</p>
<p>Understanding the command language interpreter in use on any given system will also give us an idea of what commands &amp; scripts we should use. Lets get hands-on with some of these concepts.</p>
<hr/>
<h2>Hands-on with Terminal Emulators and Shells</h2>
<p>Let's use our <code>Parrot OS</code> Pwnbox to further explore the anatomy of a shell. Click the <code>green</code> square icon at the top of the screen to open the <code>MATE</code> terminal emulator and then type something random and hit enter.</p>
<h4>Terminal Example</h4>
<p><img alt="Terminal showing command not found errors for 'wasdf' and 'meep' on a Parrot OS system." src="https://academy.hackthebox.com/storage/modules/115/green-square.png"/></p>
<p>As soon as we selected the icon, it opened the MATE terminal emulator application, which has been pre-configured to use a command language interpreter. In this instance, we are "clued" to what language interpreter is in use by seeing the <code>$</code> sign. This $ sign is used in Bash, Ksh, POSIX, and many other shell languages to mark the start of the <code>shell prompt</code> where the user can begin typing commands and other input. When we typed out our random text and hit enter, our command language interpreter was identified. That is Bash telling us that it did not recognize that command we typed. So here, we can see command language interpreters can have their own set of commands that they recognize. Another way we can identify the language interpreter is by viewing the processes running on the machine. In Linux, we can do this using the following command:</p>
<h4>Shell Validation From 'ps'</h4>
<pre><code class="language-shell-session">[!bash!]$ ps

    PID TTY          TIME CMD
   4232 pts/1    00:00:00 bash
  11435 pts/1    00:00:00 ps
</code></pre>
<p>We can also find out what shell language is in use by viewing the environment variables using the <code>env</code> command:</p>
<h4>Shell Validation Using 'env'</h4>
<pre><code class="language-shell-session">[!bash!]$ env

SHELL=/bin/bash
</code></pre>
<p>Now let's select the blue square icon at the top of the screen in Pwnbox.</p>
<h4>PowerShell vs. Bash</h4>
<p><img alt="Terminal showing PowerShell version 7.1.3 on Linux, with a prompt for a new stable release v7.2.0." src="https://academy.hackthebox.com/storage/modules/115/blue-box.png"/></p>
<p>Selecting this icon also opens the MATE terminal application but uses a different command language interpreter this time around. Compare them as they are placed side-by-side.</p>
<ul>
<li>
<code>What differences can we identify?</code>
</li>
<li>
<code>Why would we use one over the other on the same system?</code>
</li>
</ul>
<p>There are countless differences and customizations we could discover. Try using some commands you know in both and make a mental note of the differences in output and which commands are recognized. One of the main points we can take away from this is a terminal emulator is not tied to one specific language. Actually, the shell language can be changed and customized to suit the sysadmin, developer, or pentester's personal preference, workflow, and technical needs.</p>
<p><code>Now for some challenge questions to test our understanding. All answers can be found utilizing Pwnbox.</code></p>
<div class="mb-5 pwnbox-select-card"></div>
<div id="screen" style="height: 600px; border: 1px solid;">
<div class="screenPlaceholder">
<div class="instanceLoading" style="display: none;">
<h1 class="text-center" style="margin-top: 270px;"><i class="fa fa-circle-notch fa-spin"></i>
</h1>
<div class="text-center">Instance is starting...</div>
</div>
<div class="instanceTerminating" style="display: none;">
<h1 class="text-center" style="margin-top: 270px;"><i class="fa fa-circle-notch fa-spin"></i>
</h1>
<div class="text-center">Terminating instance...</div>
</div>
<div class="row instanceStart max-width-canvas">
<div class="col-4"></div>
<div class="col-4">
<button class="startInstanceBtn btn btn-success text-light btn-lg btn-block" style="margin-top: 270px;">Start Instance
                            </button>
<p class="text-center mt-2 font-size-13 font-secondary">
<span class="text-success spawnsLeft">
<i class="fal fa-infinity"></i>
</span> / 1 spawns left
                            </p>
</div>
<div class="col-4"></div>
</div>
</div>
</div>
<div class="row align-center justify-center my-4">
<div class="col-5 justify-start">
<button class="instance-button fullScreenBtn btn btn-light btn-sm float-left" style="display:none;" target="_blank"><i class="fad fa-expand text-success mr-1"></i>  Full Screen
                    </button>
<button class="instance-button terminateInstanceBtn btn btn-light btn-sm ml-2" style="display:none;"><i class="fad fa-times text-danger"></i>  Terminate
                    </button>
<button class="instance-button resetInstanceBtn btn btn-light btn-sm ml-1" style="display:none;"><i class="fad fa-sync text-warning mr-2"></i>  Reset
                    </button>
<div class="btn-group" role="group">
<button class="instance-button extendInstanceBtn btn btn-light btn-sm ml-1" style="display:none;cursor: default;">Life Left:
                            <span class="lifeLeft"></span>m
                        </button>
<button class="extendInstanceBtn extendInstanceBtnClicker btn btn-light btn-sm" data-title="Extend Life" data-toggle="tooltip" style="display:none;"><i class="fa fa-plus text-success"></i></button>
</div>
</div>
<div class="col-7 justify-end pt-2 pr-2 font-size-small text-right" id="statusText">Waiting to
                    start...
                </div>
</div>
<div class="d-inline-block mb-2 solutionSettings solutionSettingsOffsets" id="solutionsModuleSetting">
<div class="border border-secondary p-2 rounded">
<div class="custom-control custom-switch d-flex">
<input class="custom-control-input" disabled="" id="showSolutionsModuleSetting" type="checkbox"/>
<label class="custom-control-label font-size-14 font-weight-normal text-white" for="showSolutionsModuleSetting">
                                Enable step-by-step solutions for all questions
                            </label>
<span aria-hidden="true" class="cursor-pointer font-size-14 ml-1 mr-1 text-white" data-content="Access to this feature is exclusive to annual subscribers. To acquire an annual subscription, kindly proceed by clicking &lt;a href='/billing'&gt;here&lt;/a&gt;." data-html="true" data-placement="top" data-toggle="popover" data-trigger="click" title="Activate Solutions">
<i class="fa fa-info-circle font-size-12"></i>
</span>
<img alt="sparkles-icon-decoration" class="ml-2 w-auto sparkles-icon" height="20" src="/images/sparkles-solid.svg">
</img></div>
</div>
</div>
<div class="card" id="questionsDiv">
<div class="card-body">
<div class="row">
<div class="col-9">
<h4 class="card-title mt-0 font-size-medium">Questions</h4>
<p class="card-title-desc font-size-large font-size-15">Answer the question(s) below
                                to complete this Section and earn cubes!</p>
</div>
<div class="col-3 text-right float-right">
<button class="btn btn-light bg-color-blue-nav mt-2 w-100 d-flex align-items-center" data-target="#cheatSheetModal" data-toggle="modal">
<div><i class="fad fa-file-alt mr-2"></i></div>
<div class="text-center w-100 ml-1">Cheat Sheet</div>
</button>
</div>
</div>
<div>
<div>
<label class="module-question" for="718"><span class="badge badge-soft-dark font-size-14 mr-2">+ 0 <i class="fad fa-cube text-success"></i></span> Which two shell languages did we experiment with in this section? (Format: shellname&amp;shellname)
                            </label>
<div class="row">
<div class="col-lg-12 mb-4">
<input class="form-control bg-color-blue-nav" color="green" id="answer718" maxlength="191" placeholder="Submit your answer here..." type="text"/>
</div>
<div class="d-flex justify-content-end w-100 mr-3">
<p class="mb-0 mr-3 mt-1 font-size-14 font-medium text-white" id="questionStreakPointsText-718">
                                        +10 Streak pts</p>
<div class="mb-4 mr-1 d-flex align-items-center">
<button class="btn btn-primary btn-block btnAnswer" data-question-id="718" id="btnAnswer718">
<div class="submit-button-text">
<i class="fad fa-flag-checkered mr-2"></i> Submit
                                            </div>
<div class="submit-button-loader mx-4 d-none">
<i class="fa fa-circle-notch fa-spin"></i>
</div>
</button>
</div>
<div class="mb-4 mr-1">
<button class="btn btn-outline-warning btn-block" data-target="#hint718" data-toggle="modal" id="hintBtn718"><i class="fad fa-life-ring mr-2"></i> Hint
                                        </button>
</div>
</div>
</div>
<div class="custom-hr">
</div>
</div>
<div>
<label class="module-question" for="719"><span class="badge badge-soft-dark font-size-14 mr-2">+ 0 <i class="fad fa-cube text-success"></i></span> In Pwnbox issue the $PSversiontable variable using PowerShell. Submit the edition of PowerShell that is running as the answer.
                            </label>
<div class="row">
<div class="col-lg-12 mb-4">
<input class="form-control bg-color-blue-nav" color="green" id="answer719" maxlength="191" placeholder="Submit your answer here..." type="text"/>
</div>
<div class="d-flex justify-content-end w-100 mr-3">
<p class="mb-0 mr-3 mt-1 font-size-14 font-medium text-white" id="questionStreakPointsText-719">
                                        +10 Streak pts</p>
<div class="mb-4 mr-1 d-flex align-items-center">
<button class="btn btn-primary btn-block btnAnswer" data-question-id="719" id="btnAnswer719">
<div class="submit-button-text">
<i class="fad fa-flag-checkered mr-2"></i> Submit
                                            </div>
<div class="submit-button-loader mx-4 d-none">
<i class="fa fa-circle-notch fa-spin"></i>
</div>
</button>
</div>
<div class="mb-4 mr-1">
<button class="btn btn-outline-warning btn-block" data-target="#hint719" data-toggle="modal" id="hintBtn719"><i class="fad fa-life-ring mr-2"></i> Hint
                                        </button>
</div>
</div>
</div>
<div class="">
</div>
</div>
</div>
</div>
</div>
