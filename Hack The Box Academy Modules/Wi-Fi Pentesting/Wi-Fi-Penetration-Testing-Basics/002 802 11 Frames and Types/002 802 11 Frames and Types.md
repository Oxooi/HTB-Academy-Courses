
<h1>802.11 Frames and Types</h1>
<hr/>
<p>In order to understand 802.11 traffic better, we can dive into frame construction, types, and subtypes. In 802.11 communications, there are a few different frame types utilized for different actions. These actions are all a part of the connection cycle, and standard communications for these wireless networks. Many of our attacks utilize packet crafting/forging techniques. We look to forge these same frames to perform actions like disconnecting a client device from the network with a deauthentication/disassociation request.</p>
<h4>The IEEE 802.11 MAC Frame</h4>
<p>All 802.11 frames utilize the MAC frame. This frame is the foundation for all other fields and actions that are performed between the client and access point, and even in ad-hoc networks. The MAC data frame consists of 9 fields.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Frame Control</td>
<td>This field contains tons of information such as type, subtype, protocol version, to ds (distribution system), from DS, Order, etcetera.</td>
</tr>
<tr>
<td>Duration/ID</td>
<td>This ID clarifies the amount of time in which the wireless medium is occupied.</td>
</tr>
<tr>
<td>Address 1, 2, 3, and 4</td>
<td>These fields clarify the MAC addresses involved in the communication, but they could mean different things depending on the origin of the frame. These tend to include the BSSID of the access point and the client MAC address, among others.</td>
</tr>
<tr>
<td>SC</td>
<td>The sequence control field allows additional capabilities to prevent duplicate frames.</td>
</tr>
<tr>
<td>Data</td>
<td>Simply put, this field is responsible for the data that is transmitted from the sender to the receiver.</td>
</tr>
<tr>
<td>CRC</td>
<td>The cyclic redundancy check contains a 32-bit checksum for error detection.</td>
</tr>
</tbody>
</table>
<h4>IEEE 802.11 Frame Types</h4>
<p>IEEE frames can be put into different categories for what they do and what actions they are involved in. Generally speaking, we have the following types among some others. These codes can help us when filtering Wireshark traffic.</p>
<ol>
<li>
<code>Management (00):</code> These frames are used for management and control, and allowing the access point and client to control the active connection.</li>
<li>
<code>Control (01):</code> Control frames are used for managing the transmission and reception of data frames within wi-fi networks. We can consider them like a sense of quality control.</li>
<li>
<code>Data (10):</code> Data frames are used to contain data for transmission.</li>
</ol>
<h4>Management Frame Sub-Types</h4>
<p>Primarily, for wi-fi penetration testing, we focus on management frames. These frames after all are used to control the connection between the access point and client. As such we can dive into each one, and what they are responsible for.</p>
<p>If we look to filter them in Wireshark, we would specify type <code>00</code> and subtypes like the following.</p>
<ol>
<li>
<code>Beacon Frames (1000)</code>
</li>
<li>
<code>Probe Request (0100) and Probe Response (0101)</code>
</li>
<li>
<code>Authentication Request and Response (1011)</code>
</li>
<li>
<code>Association/Reassociation Request and Responses (0000, 0001, 0010, 0011)</code>
</li>
<li>
<code>Disassociation/Deauthentication (1010, 1100)</code>
</li>
</ol>
<h4>1. Beacon Frames</h4>
<p>Beacon frames are primarily used by the access point to communicate its presence to the client or station. It includes information such as supported ciphers, authentication types, its SSID, and supported data rates among others.</p>
<h4>2. Probe Requests and Responses</h4>
<p>The probe request and response process exist to allow the client to discover nearby access points. Simply put, if a network is hidden or not hidden, a client will send a probe request with the SSID of the access point. The access point will then respond with information about itself for the client.</p>
<h4>3. Authentication Request and Response</h4>
<p>Authentication requests are sent by the client to the access point to begin the connection process. These frames are primarily used to identify the client to the access point.</p>
<h4>4. Association/Reassociation Requests</h4>
<p>After sending an authentication request and undergoing the authentication process, the client sends an association request to the access point. The access point then responds with an association response to indicate whether the client is able to associate with it or not.</p>
<h4>5. Disassociation/Deauthentication Frames</h4>
<p>Disassociation and Deauthentication frames are sent from the access point to the client. Similar to their inverse frames (association and authentication), they are designed to terminate the connection between the access point and the client. These frames additionally contain what is known as a reason code. This reason code indicates why the client is being disconnected from the access point. We utilize crafting these frames for many handshake captures and denial of service based attacks during wi-fi penetration testing efforts.</p>
<hr/>
<h1>The Connection Cycle</h1>
<p>Now that IEEE 802.11 frame types and management frame sub-types have been reviewed, let's examine the typical connection process between clients and access points, known as the <code>connection cycle</code>. We will focus on basic WPA2 authentication, although this process may vary depending on the Wi-Fi standard in use. However, the general connection cycle follows this sequence.</p>
<ol>
<li>
<code>Beacon Frames</code>
</li>
<li>
<code>Probe Request and Response</code>
</li>
<li>
<code>Authentication Request and Response</code>
</li>
<li>
<code>Association Request and Response</code>
</li>
<li>
<code>Some form of handshake or other security mechanism</code>
</li>
<li>
<code>Disassociation/Deauthentication</code>
</li>
</ol>
<p>To better understand this process, the raw network traffic can be examined in Wireshark. After successfully capturing a valid handshake, the capture file can then be opened in Wireshark for detailed analysis.</p>
<p>Beacon frames from the access point can be identified using the following Wireshark filter:</p>
<p><code>(wlan.fc.type == 0) &amp;&amp; (wlan.fc.type_subtype == 8)</code></p>
<p><img alt="BASICS" src="https://academy.hackthebox.com/storage/modules/222/001_beacon.PNG"/></p>
<p>Probe request frames from the access point can be identified using the following Wireshark filter:</p>
<p><code>(wlan.fc.type == 0) &amp;&amp; (wlan.fc.type_subtype == 4)</code></p>
<p><img alt="BASICS" src="https://academy.hackthebox.com/storage/modules/222/002_probe_request.PNG"/></p>
<p>Probe response frames from the access point can be identified using the following Wireshark filter:</p>
<p><code>(wlan.fc.type == 0) &amp;&amp; (wlan.fc.type_subtype == 5)</code></p>
<p><img alt="BASICS" src="https://academy.hackthebox.com/storage/modules/222/003_probe_response.PNG"/></p>
<p>The authentication process between the client and the access point can be observed using the following Wireshark filter:</p>
<p><code>(wlan.fc.type == 0) &amp;&amp; (wlan.fc.type_subtype == 11)</code></p>
<p><img alt="BASICS" src="https://academy.hackthebox.com/storage/modules/222/004_authentication.PNG"/></p>
<p>After the authentication process is complete, the station's association request can be viewed using the following Wireshark filter:</p>
<p><code>(wlan.fc.type == 0) &amp;&amp; (wlan.fc.type_subtype == 0)</code></p>
<p><img alt="BASICS" src="https://academy.hackthebox.com/storage/modules/222/005_association_request.PNG"/></p>
<p>The access point's association response can be viewed using the following Wireshark filter:</p>
<p><code>(wlan.fc.type == 0) &amp;&amp; (wlan.fc.type_subtype == 1)</code></p>
<p><img alt="BASICS" src="https://academy.hackthebox.com/storage/modules/222/006_association_response.PNG"/></p>
<p>If the example network uses WPA2, the EAPOL (handshake) frames can be viewed using the following Wireshark filter:</p>
<p><code>eapol</code></p>
<p><img alt="BASICS" src="https://academy.hackthebox.com/storage/modules/222/007_handshake.PNG"/></p>
<p>Once the connection process is complete, the termination of the connection can be viewed by identifying which party (client or access point) initiated the disconnection. This can be done using the following Wireshark filter to capture Disassociation frames (10) or Deauthentication frames (12).</p>
<p><code>(wlan.fc.type == 0) &amp;&amp; (wlan.fc.type_subtype == 12) or (wlan.fc.type_subtype == 10)</code></p>
<p><img alt="BASICS" src="https://academy.hackthebox.com/storage/modules/222/008_Disassociation.PNG"/></p>
<p>Now that we know a little about the types of frames, in the next section, we will explore the different authentication methods and cover the basic connection cycle between the client and the access point.</p>
