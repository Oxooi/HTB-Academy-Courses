
<h1>Reconnaissance and Public Networks</h1>
<hr/>
<p>Before testing a captive portal system, it's essential to first analyze the network itself. A misconfigured or poorly implemented network may allow us to bypass the captive portal entirely, making it unnecessary to test authentication mechanisms directly.</p>
<hr/>
<h2>Encrypted vs Unencrypted</h2>
<p>Interception techniques vary in effectiveness depending on the layer at which they are applied. Capturing data at the data-link layer instead of the network layer can often determine whether our attack succeeds or fails.</p>
<p>For instance, if we want to check whether a public network is encrypted, we can use airodump-ng while our wireless interface is in monitor mode. This allows us to gather details about the target network’s security configuration.</p>
<p>If the network employs <code>Opportunistic Wireless Encryption (OWE)</code>, we may observe the following behavior:</p>
<pre><code class="language-shell-session">[!bash!]$ sudo airodump-ng -c 1 --bssid A6:89:F8:B8:78:DA wlan0mon

CH  1 ][ Elapsed: 18 s ][ 1234-56-78 12:34 ][ WPA handshake: A6:89:F8:B8:78:DA 

BSSID              PWR RXQ  Beacons    #Data, #/s  CH   MB   ENC CIPHER  AUTH ESSID

A6:89:F8:B8:78:DA  -50 100      183      553    0   1   11   WPA3 CCMP   OWE  HTB-Guest     

BSSID              STATION            PWR   Rate    Lost    Frames  Notes  Probes

A6:89:F8:B8:78:DA  3E:C2:CC:02:21:08  -10   11 - 1      1      607  EAPOL
</code></pre>
<p>On the other hand, if the network is <code>unencrypted (open)</code>, we might notice:</p>
<pre><code class="language-shell-session">[!bash!]$ sudo airodump-ng -c 1 --bssid A6:89:F8:B8:78:DA wlan0mon

CH  1 ][ Elapsed: 15 s ][ 1234-56-78 12:34 ][ ]

BSSID              PWR RXQ  Beacons    #Data, #/s  CH   MB   ENC CIPHER  AUTH ESSID

A6:89:F8:B8:78:DA  -50 100      183      553    0   1   11   OPN              HTB-Guest

BSSID              STATION            PWR   Rate    Lost    Frames  Notes  Probes

A6:89:F8:B8:78:DA  3E:C2:CC:02:21:08  -10   11 - 1      1      916
</code></pre>
<p>When a network uses OWE, passive sniffing becomes significantly more challenging since encryption and session keys are generated per client. This also makes MAC spoofing attacks much harder to execute.</p>
<p>However, OWE does not prevent man-in-the-middle (MITM) attacks, such as evil twin attacks. If we identify an open network, we may be able to intercept traffic directed toward the captive portal. If the portal relies on HTTP instead of HTTPS, capturing login credentials or other transmitted data becomes straightforward. Even in cases where HTTPS is enforced, we can still attempt SSL stripping or other interception techniques to downgrade security and capture sensitive information.</p>
<hr/>
<h2>Finding the Gateway and Routes</h2>
<p>First, we need to identify the network gateway. We can do this by checking the routing table using the following command:</p>
<pre><code class="language-shell-session">[!bash!]$ route -n

Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.1.1     0.0.0.0         UG    100    0        0 wlan0
192.168.1.1     0.0.0.0         255.255.255.0   U     100    0        0 wlan0
</code></pre>
<p>Here, the gateway IP address is <code>192.168.1.1</code>, which is the device handling traffic for the network. Identifying the gateway is a crucial first step before performing further network analysis or testing. In most cases, the gateway IP will correspond to the captive portal managing network access. If the network allows ICMP traffic, we can use traceroute to analyze how traffic is being handled. Running a traceroute can help us determine whether all traffic is being blocked or redirected or if only specific types of traffic (e.g., HTTP/HTTPS) are affected. This insight can be useful for identifying potential weaknesses or workarounds in the network’s routing policies.</p>
<p>If we are connected to a public network that enforces routing rules via iptables, we may want to determine whether all traffic is being blocked or if only specific ports, such as 80 (HTTP) and 443 (HTTPS), are restricted.</p>
<p>One way to analyze this is by using traceroute techniques.</p>
<pre><code class="language-shell-session">[!bash!]$ traceroute 8.8.8.8

traceroute to 8.8.8.8 (8.8.8.8), 30 hops max, 60 byte packets
 1  192.168.0.1 (192.168.0.1)  0.719 ms  0.668 ms  0.835 ms
 2  192.168.10.1 (192.168.10.1)  24.071 ms  24.061 ms  24.150 ms
 &lt;snip&gt;
 6  * dns.google (8.8.8.8)  17.866 ms *
</code></pre>
<p>By default, traceroute sends packets to UDP port 33434 and increments the port number with each probe. If we observe responses to our traceroute attempts, it may indicate that ICMP requests are allowed and that the network is forwarding traffic except for specific ports like 80 (HTTP) and 443 (HTTPS) through the bridge.</p>
<p>To confirm this behavior, we can manually specify the destination port in traceroute, allowing us to test whether traffic to restricted ports is being blocked while other traffic is permitted.</p>
<pre><code class="language-shell-session">[!bash!]$ traceroute -p 80 8.8.8.8

traceroute to 8.8.8.8 (8.8.8.8), 30 hops max, 60 byte packets
1  192.168.0.1 (192.168.0.1)  0.719 ms  0.668 ms  0.835 ms
2  * * *
3  * * *
4  * * *
</code></pre>
<p>If we observe inconsistent behavior in our tests, it may indicate poor network segmentation. Performing these simple traceroute steps before initiating host discovery can help us identify potential weaknesses while saving time.</p>
<p>This type of segmentation issue is common in many captive portal networks. Some devices, such as Android, use a Captive Portal Detection API to determine whether authentication is required before granting full internet access. For example, Android devices attempt a DNS query to <code>connectivitycheck.gstatic.com</code> to check network connectivity. Similarly, Windows devices use <code>www.msftconnecttest.com/connecttest.txt</code> to check connectivity and exhibit the same behavior.</p>
<p>Since certain devices need at least partial internet access to function properly on public networks, we may discover alternative routes that allow us to bypass the captive portal entirely. Ultimately, our reconnaissance approach depends on the specific technique we plan to use, and our choice of technique is informed by the results of our reconnaissance. In the following sections, we will explore different methods for testing captive portals and identifying whether they present viable attack vectors.</p>
<hr/>
<h2>Checking the Captive Portal Service Versions</h2>
<p>In many cases, captive portal servers function more like full-fledged web servers rather than just embedded systems. As a result, they often run a variety of services similar to those found on traditional web servers. By connecting to the target public wireless network and scanning the captive portal web server, we can identify its running services and their versions. This information can help us assess potential vulnerabilities or misconfigurations that may be exploitable.</p>
<pre><code class="language-shell-session">[!bash!]$ sudo nmap -p- -sV 192.168.0.1

Starting Nmap 7.92 ( https://nmap.org ) at xxxx-xx-xx xx:xx xxx
Nmap scan report for example.com (192.168.1.1)
PORT     STATE SERVICE
22/tcp   open  OpenSSH
80/tcp   open  Apache/2.4.29
443/tcp  open  Apache/2.4.29 (Ubuntu)
3306/tcp open  mysql
8080/tcp open  Apache Tomaact/9.0.38
</code></pre>
<p>In this scenario, if we successfully intercept or inject traffic, we may be able to validate usernames against the OpenSSH service, depending on its version. In some cases, this could even lead to hijacking the server entirely. Beyond interception, thorough reconnaissance is essential. We should research each identified service version and consider web fuzzing to uncover potential vulnerabilities. For instance, if we fuzz port 80 and discover CGI scripts, there may be an opportunity to achieve remote code execution (RCE).</p>
<p>Careful enumeration and testing can reveal weaknesses that might not be immediately obvious, making them valuable steps in assessing the security posture of a target.</p>
<div class="my-3 p-3 vpn-switch-card" id="vpn-switch">
<p class="font-size-14 color-white mb-0">VPN Servers</p>
<p class="font-size-13 mb-0">
<i class="fas fa-exclamation-triangle text-warning"></i><span class="color-white ml-1">Warning:</span> Each
                    time you "Switch",
                    your connection keys are regenerated and you must re-download your VPN connection file.
                </p>
<p class="font-size-13 mb-0">
                    All VM instances associated with the old VPN Server will be terminated when switching to
                    a new VPN server. <br/>
                    Existing PwnBox instances will automatically switch to the new VPN server.</p>
<div class="row mb-3">
<div class="col-12 mt-2">
<div class="d-none justify-content-center vpn-loader">
<div class="spinner-border text-success" role="status">
<span class="sr-only">Switching VPN...</span>
</div>
</div>
<select aria-label="vpn server" class="selectpicker custom-form-control vpnSelector badge-select" title="Select VPN Server">
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 6 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt; &lt;span class='recommended'&gt; &lt;img src='/images/sparkles-solid.svg'/&gt;Recommended&lt;/span&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="30" value="17">US Academy 6</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 5 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="31" value="16">US Academy 5</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 2 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="32" value="5">US Academy 2</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 4 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="32" value="13">US Academy 4</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 1 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="34" value="4">US Academy 1</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 3 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="37" value="9">US Academy 3</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 5 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt; &lt;span class='recommended'&gt; &lt;img src='/images/sparkles-solid.svg'/&gt;Recommended&lt;/span&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="37" value="12">EU Academy 5</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 2 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="40" selected="" value="2">EU Academy 2</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 1 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="42" value="1">EU Academy 1</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 3 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="42" value="14">EU Academy 3</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 4 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="43" value="11">EU Academy 4</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 6 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="48" value="15">EU Academy 6</option>
</select>
<p class="font-size-14 color-white mb-0 mt-2">PROTOCOL</p>
<div class="d-flex">
<div class="custom-control custom-radio custom-control-inline">
<input checked="" class="custom-control-input" id="rd_1" name="vpn-protocol" type="radio" value="udp"/>
<label class="custom-control-label green font-size-14" for="rd_1">UDP
                                    1337</label>
</div>
<div class="custom-control custom-radio">
<input class="custom-control-input" id="rd_2" name="vpn-protocol" type="radio" value="tcp"/>
<label class="custom-control-label green font-size-14" for="rd_2">TCP
                                    443</label>
</div>
</div>
<div class="d-flex justify-content-center">
<button class="btn btn-outline-success btn-lg download-vpn-settings mt-3 px-5 font-size-12">
                                DOWNLOAD VPN CONNECTION FILE
                            </button>
</div>
</div>
</div>
</div>
<div class="mb-5 pwnbox-select-card"></div>
<div id="screen" style="height: 600px; border: 1px solid;">
<div class="screenPlaceholder">
<div class="instanceLoading" style="display: none;">
<h1 class="text-center" style="margin-top: 270px;"><i class="fa fa-circle-notch fa-spin"></i>
</h1>
<div class="text-center">Instance is starting...</div>
</div>
<div class="instanceTerminating" style="display: none;">
<h1 class="text-center" style="margin-top: 270px;"><i class="fa fa-circle-notch fa-spin"></i>
</h1>
<div class="text-center">Terminating instance...</div>
</div>
<div class="row instanceStart max-width-canvas">
<div class="col-4"></div>
<div class="col-4">
<button class="startInstanceBtn btn btn-success text-light btn-lg btn-block" style="margin-top: 270px;">Start Instance
                            </button>
<p class="text-center mt-2 font-size-13 font-secondary">
<span class="text-success spawnsLeft">
<i class="fal fa-infinity"></i>
</span> / 1 spawns left
                            </p>
</div>
<div class="col-4"></div>
</div>
</div>
</div>
<div class="row align-center justify-center my-4">
<div class="col-5 justify-start">
<button class="instance-button fullScreenBtn btn btn-light btn-sm float-left" style="display:none;" target="_blank"><i class="fad fa-expand text-success mr-1"></i>  Full Screen
                    </button>
<button class="instance-button terminateInstanceBtn btn btn-light btn-sm ml-2" style="display:none;"><i class="fad fa-times text-danger"></i>  Terminate
                    </button>
<button class="instance-button resetInstanceBtn btn btn-light btn-sm ml-1" style="display:none;"><i class="fad fa-sync text-warning mr-2"></i>  Reset
                    </button>
<div class="btn-group" role="group">
<button class="instance-button extendInstanceBtn btn btn-light btn-sm ml-1" style="display:none;cursor: default;">Life Left:
                            <span class="lifeLeft"></span>m
                        </button>
<button class="extendInstanceBtn extendInstanceBtnClicker btn btn-light btn-sm" data-title="Extend Life" data-toggle="tooltip" style="display:none;"><i class="fa fa-plus text-success"></i></button>
</div>
</div>
<div class="col-7 justify-end pt-2 pr-2 font-size-small text-right" id="statusText">Waiting to
                    start...
                </div>
</div>
<div class="d-inline-block mb-2 solutionSettings solutionSettingsOffsets" id="solutionsModuleSetting">
<div class="border border-secondary p-2 rounded">
<div class="custom-control custom-switch d-flex">
<input class="custom-control-input" disabled="" id="showSolutionsModuleSetting" type="checkbox"/>
<label class="custom-control-label font-size-14 font-weight-normal text-white" for="showSolutionsModuleSetting">
                                Enable step-by-step solutions for all questions
                            </label>
<span aria-hidden="true" class="cursor-pointer font-size-14 ml-1 mr-1 text-white" data-content="Access to this feature is exclusive to annual subscribers. To acquire an annual subscription, kindly proceed by clicking &lt;a href='/billing'&gt;here&lt;/a&gt;." data-html="true" data-placement="top" data-toggle="popover" data-trigger="click" title="Activate Solutions">
<i class="fa fa-info-circle font-size-12"></i>
</span>
<img alt="sparkles-icon-decoration" class="ml-2 w-auto sparkles-icon" height="20" src="/images/sparkles-solid.svg">
</img></div>
</div>
</div>
<div class="card" id="questionsDiv">
<div class="card-body">
<div class="row">
<div class="col-9">
<h4 class="card-title mt-0 font-size-medium">Questions</h4>
<p class="card-title-desc font-size-large font-size-15">Answer the question(s) below
                                to complete this Section and earn cubes!</p>
<span class="spawnTargetBtn spawn-target-text-clone d-none">Click here to spawn the target
                                system!</span>
<p class="card-title-desc font-size-large font-size-15 mb-0">
    Target(s): <span class="text-success">
<span class="target" style="cursor:pointer;">
<i class="fad fa-circle-notch fa-spin"></i>
<span class="spawnTargetBtn">Fetching status...</span>
</span>
</span>
<button class="resetTargetBtn btn btn-light btn-sm" data-title="Reset Target(s)" data-toggle="tooltip" style="cursor: pointer; display: none;">
<i class="fad fa-sync text-warning"></i>
</button>
<br/>
<div class="d-flex align-items-center targetLifeContainer">
<span class="targetLifeTimeContainer" style="display: none;">
            Life Left: <span class="targetLifeTime font-size-15">0</span> minute(s)
                            <button class="extendTargetSystemBtn btn btn-light btn-sm module-button" data-title="Extend Life by 1 hour (up to 6 hours total lifespan)" data-toggle="tooltip">
<i class="fa fa-plus text-success extend-icon"></i>
<div class="extend-loader spinner-border spinner-border-small text-success d-none" role="status">
</div>
</button>
<button class="text-danger btn btn-light btn-sm module-button font-size-16 mb-1" data-target="#terminateVmModal" data-toggle="modal">
                    Terminate <span class="fa-regular fa-x text-danger font-size-13 ml-2"></span>
</button>
</span>
</div>
</p>
</div>
<div class="col-3 text-right float-right">
<button class="btn btn-light bg-color-blue-nav mt-2 w-100 d-flex align-items-center" data-target="#cheatSheetModal" data-toggle="modal">
<div><i class="fad fa-file-alt mr-2"></i></div>
<div class="text-center w-100 ml-1">Cheat Sheet</div>
</button>
<a class="btn btn-light bg-color-blue-nav mt-2 d-flex align-items-center" data-title='Key is already installed in "My Workstation"' data-toggle="tooltip" href="https://academy.hackthebox.com/vpn/key">
<div><i class="fad fa-chart-network mr-2"></i></div>
<div class="text-center w-100">Download VPN Connection File</div>
</a>
</div>
</div>
<div>
<div>
<p class="mb-0 font-size-12"><i class="fad fa-chart-network text-success mr-2 font-size-medium"></i>
                                RDP
                                to <span class="target-protocol-ip target-protocol-ip-2966 text-dark"></span> with user "<span class="text-success">wifi</span>" and
                                password "<span class="text-danger">wifi</span>" </p>
<label class="module-question" for="2966"><span class="badge badge-soft-dark font-size-14 mr-2">+ 2 <i class="fad fa-cube text-success"></i></span> Connect to the HTB-Guest Wi-Fi network and perform reconnaissance. What is the gateway IP address?
                            </label>
<div class="row">
<div class="col-lg-12 mb-4">
<input class="form-control bg-color-blue-nav" color="green" id="answer2966" maxlength="191" placeholder="Submit your answer here..." type="text"/>
</div>
<div class="d-flex justify-content-end w-100 mr-3">
<p class="mb-0 mr-3 mt-1 font-size-14 font-medium text-white" id="questionStreakPointsText-2966">
                                        +10 Streak pts</p>
<div class="mb-4 mr-1 d-flex align-items-center">
<button class="btn btn-primary btn-block btnAnswer" data-question-id="2966" id="btnAnswer2966">
<div class="submit-button-text">
<i class="fad fa-flag-checkered mr-2"></i> Submit
                                            </div>
<div class="submit-button-loader mx-4 d-none">
<i class="fa fa-circle-notch fa-spin"></i>
</div>
</button>
</div>
</div>
</div>
<div class="custom-hr">
</div>
</div>
<div>
<p class="mb-0 font-size-12"><i class="fad fa-chart-network text-success mr-2 font-size-medium"></i>
                                RDP
                                to <span class="target-protocol-ip target-protocol-ip-2967 text-dark"></span> with user "<span class="text-success">wifi</span>" and
                                password "<span class="text-danger">wifi</span>" </p>
<label class="module-question" for="2967"><span class="badge badge-soft-dark font-size-14 mr-2">+ 2 <i class="fad fa-cube text-success"></i></span> What is the Apache httpd version running on the captive portal gateway? (Format example: 2.2.2)
                            </label>
<div class="row">
<div class="col-lg-12 mb-4">
<input class="form-control bg-color-blue-nav" color="green" id="answer2967" maxlength="191" placeholder="Submit your answer here..." type="text"/>
</div>
<div class="d-flex justify-content-end w-100 mr-3">
<p class="mb-0 mr-3 mt-1 font-size-14 font-medium text-white" id="questionStreakPointsText-2967">
                                        +10 Streak pts</p>
<div class="mb-4 mr-1 d-flex align-items-center">
<button class="btn btn-primary btn-block btnAnswer" data-question-id="2967" id="btnAnswer2967">
<div class="submit-button-text">
<i class="fad fa-flag-checkered mr-2"></i> Submit
                                            </div>
<div class="submit-button-loader mx-4 d-none">
<i class="fa fa-circle-notch fa-spin"></i>
</div>
</button>
</div>
</div>
</div>
<div class="">
</div>
</div>
</div>
</div>
</div>
