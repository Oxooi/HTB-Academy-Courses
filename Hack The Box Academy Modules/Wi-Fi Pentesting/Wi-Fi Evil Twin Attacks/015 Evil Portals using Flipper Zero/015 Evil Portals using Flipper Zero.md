
<h1>Evil Portals using Flipper Zero</h1>
<hr/>
<p>One of the easiest ways to launch an Evil Portal attack is using the highly portable <a href="https://shop.flipperzero.one/">Flipper Zero</a> with the <a href="https://shop.flipperzero.one/products/wifi-devboard">genuine WiFi Dev Board</a>. The WiFi Dev Board, based on the ESP32-S2 module,  connects to the Flipper Zero through the GPIO pins at the top, giving it WiFi connection capabilities, and expanding its potential into MKID capturing, de-authentication attacks, and more.</p>
<p><img alt="Flipper Boxed" src="https://academy.hackthebox.com/storage/modules/291/15/S1S0.jpg"/></p>
<p><strong>Disclaimer:</strong>
This section will walk you through flashing the FlipperZero <a href="https://github.com/DarkFlippers/unleashed-firmware">Unleashed firmware</a> and the WiFi Dev Board <a href="https://github.com/bigbrodude6119/flipper-zero-evil-portal">Evil Portal firmware</a>, as a method to avoid any inconsistency in configuration. The Unleashed firmware is a well-vetted, tried-and-true environment from which you can follow along with this section.</p>
<p>The Unleashed firmware is an <em>unlocked</em> version of the Flipper Zero OEM firmware, implying that multiple regional and regulatory restrictions are lifted on it. Please read the <a href="https://github.com/DarkFlippers/unleashed-firmware#whats-changed">documentation</a> and inform yourself of the risks inherent to your specific country before using any of the unlocked capabilities of your Flipper Zero. This is an educational tool and should only be used to this extent.</p>
<hr/>
<h1>Preparation</h1>
<h2>Flashing the Unleashed firmware on the Flipper Zero</h2>
<p>Navigate to the <a href="https://github.com/DarkFlippers/unleashed-firmware/releases/">Releases page</a> of the Flipper Zero Unleashed repository and download the latest firmware (<code>.tgz</code> format). At the time of writing, this is <code>flipper-z-f7-update-unlshd-079e.tgz</code>.</p>
<p>The letters at the end of each version stand for specific types of pre-loaded applications:</p>
<ul>
<li>Default - <code>no letter</code>
</li>
<li>Extra apps - <code>e</code>
</li>
<li>No apps - <code>c</code>
</li>
<li>RGB mod patch - <code>r</code>
</li>
</ul>
<p>In our case, we are downloading the firmware with extra apps, to shorten the configuration time. The extra apps pack will contain the ESP32-S2 applications for the Flipper Zero that will allow us to interface with the WiFi Dev Board.</p>
<p><img alt="Flipper Firmware" src="https://academy.hackthebox.com/storage/modules/291/15/S1S1.png"/></p>
<p>To upload and apply the firmware you've just downloaded, you have several options:</p>
<ul>
<li>Using the <a href="https://github.com/DarkFlippers/unleashed-firmware/blob/dev/documentation/HowToInstall.md#with-qflipper-120">qFlipper software</a>
</li>
<li>Using the <a href="https://github.com/DarkFlippers/unleashed-firmware/blob/dev/documentation/HowToInstall.md#with-web-updater">web updater</a>
</li>
<li>Using the <a href="https://github.com/DarkFlippers/unleashed-firmware/blob/dev/documentation/HowToInstall.md#with-ios-mobile-app">iOS mobile app</a>
</li>
<li>Using the <a href="https://github.com/DarkFlippers/unleashed-firmware/blob/dev/documentation/HowToInstall.md#with-android-mobile-app-with-tgz-download">Android mobile app</a>
</li>
<li>Manually from the Flipper Zero's <a href="https://github.com/DarkFlippers/unleashed-firmware/blob/dev/documentation/HowToInstall.md#with-offline-update-on-flipper">storage SD card</a>
</li>
</ul>
<hr/>
<h2>Optional: Removing installed firmware from the WiFi Dev Board</h2>
<p>If you've been using the WiFi Dev Board for some time, and have already flashed a different firmware on it, you will need to remove it before installing the Evil Portal release. Follow the commands below to wipe the ESP32-S2 chip and start with a clean slate.</p>
<pre><code class="language-shell-session">[!bash!]$ pip3 install esptool

[!bash!]$ pip3 install setuptools
</code></pre>
<p>Once the two modules have been installed, it's time to connect the WiFi Dev Board to your computer. First, hold the BOOT button down, connect the board to your computer while holding the button down for 3-4 more seconds, then release. This will put the board into firmware flashing mode.</p>
<p>You can then issue the following command to erase the currently installed firmware:</p>
<pre><code class="language-shell-session">[!bash!]$ python3 -m esptool –chip esp32s2 erase_flash
</code></pre>
<p>Ensure the command runs successfully, then proceed to the next step.</p>
<hr/>
<h2>Flashing the Evil Portal firmware on the WiFi Dev Board</h2>
<p>The next step is flashing the appropriate firmware on the WiFi Dev Board as well. The board comes with a USB-C port that will facilitate this. Please note that the board should be disconnected from both your computer and the Flipper Zero at this time.</p>
<p>Before we start, download the latest firmware version from the <a href="https://github.com/bigbrodude6119/flipper-zero-evil-portal/releases">Releases page</a> of the Evil Portal repository. The firmware file you need is the <code>wifi_dev_board.zip</code> archive, which will contain 4 <code>.bin</code> files. Extract these out of the archive and have them easily accessible.</p>
<p><img alt="WiFi Board Firmware" src="https://academy.hackthebox.com/storage/modules/291/15/S1S2.png"/></p>
<p>Once the four <code>.bin</code> files have been extracted, it's time to connect the WiFi Dev Board to your computer. First, hold the BOOT button down, connect the board to your computer while holding the button down for 3-4 more seconds, then release. This will put the board into firmware flashing mode.</p>
<p>Visit <a href="https://esp.huhn.me/">this website</a> and hit the Connect button. You will see a pop-up from your browser, prompting you to select the interface you want to connect to. The ESP32-S2 SoC should appear on the list and you can select it and hit the Connect button on the pop-up. If it does not, you haven't booted correctly into firmware flashing mode, and you should repeat the steps above, or seek further support from the team.</p>
<p><img alt="Firmware Flashing" src="https://academy.hackthebox.com/storage/modules/291/15/S1S3.png"/></p>
<p>Once connected to the ESP32-S2, upload the four <code>.bin</code> files and make sure the following memory addresses are assigned to each. When ready, press the Program button.</p>
<ul>
<li>
<code>0x1000</code> - <code>EvilPortal.ino.bootloader.bin</code>
</li>
<li>
<code>0x8000</code> - <code>EvilPortal.ino.partitions.bin</code>
</li>
<li>
<code>0xe000</code> - <code>boot_app0.bin</code>
</li>
<li>
<code>0x10000</code> - <code>EvilPortal.ino.bin</code>
</li>
</ul>
<p>The <code>.bin</code> files will be flashed to the ESP32-S2 and you will observe a successful "Done!" message at the end of the output. If this is the case, you may disconnect your WiFi Dev Board from your computer and set it aside for a moment.</p>
<p><img alt="Firmware Memory Addressing" src="https://academy.hackthebox.com/storage/modules/291/15/S1S4.png"/></p>
<hr/>
<h2>Optional: Installing the Evil Portal app on Flipper Zero</h2>
<p>The Evil Portal app is found under: <code>Apps &gt; GPIO &gt; [ESP32] Evil Portal</code>. In this module, we are running version <code>0.0.2</code>, which can be confirmed under the <code>Help</code> menu inside the app.</p>
<p>If you haven't chosen the Unleashed firmware version containing all of the extra apps (<code>flipper-z-f7-update-unlshd-###e.tgz</code>), or if the Evil Portal app is somehow absent from your Flipper Zero, you will need to follow these steps. The app is required to interface with the WiFi Dev Board firmware.</p>
<p>You can simply download the app from the same <a href="https://github.com/bigbrodude6119/flipper-zero-evil-portal/releases">Releases page</a> as the firmware. The file you are looking to download is the <code>unleashed-evil_portal.fap.zip</code> file. Once downloaded, you will need to unzip it on your computer, then copy it over to your Flipper Zero SD card under the location <code>SD Card/apps/GPIO/evil_portal.fap</code>.</p>
<p>Please note that this <code>.fap</code> file is built specifically for the Unleashed firmware. It will not work if you are using the official Release version of the Flipper Zero firmware. If you are on a different firmware you can download the <code>evil_portal.fap</code> file at <a href="https://flipc.org/bigbrodude6119/flipper-zero-evil-portal?branch=main&amp;root=flipper/flipper-evil-portal&amp;firmware=unleashed">flipc.org</a> or you can build the <code>.fap</code> file yourself by following <a href="https://github.com/flipperdevices/flipperzero-firmware/blob/dev/documentation/AppsOnSDCard.md">these instructions</a>.</p>
<p>You can use the <a href="https://flipperzero.one/update">qFlipper's</a> interface to upload directly into the directory above by right-clicking any space in the directory, selecting "Upload here...", and picking the <code>.fap</code> file from your computer.</p>
<p><img alt="Application Upload" src="https://academy.hackthebox.com/storage/modules/291/15/S1S5.png"/></p>
<hr/>
<h2>Configuring the Evil Portal</h2>
<p>As a last step, download the Evil Portal app resources folder from the same <a href="https://github.com/bigbrodude6119/flipper-zero-evil-portal/releases">Releases page</a>. The file <code>evil_portal_sd_folder.zip</code> will contain the <code>index.html</code> page used by the app to start the captive portal. As the name suggests, the contents of this archive also go on Flipper Zero's SD card storage: <code>SD Card/apps_data/evil_portal</code>.</p>
<p>If the folder is not present, create it using the right-click menu on <code>qFlipper</code>.</p>
<p><img alt="App Data Creation" src="https://academy.hackthebox.com/storage/modules/291/15/S1S6.png"/></p>
<p>Then, copy over the <code>ap.config.txt</code> and <code>index.html</code> files and make sure the <code>logs</code> folder is created as well.</p>
<p><img alt="App Data View" src="https://academy.hackthebox.com/storage/modules/291/15/S1S7.png"/></p>
<p>Clones of popular captive portals that you can use to test out the app for the first time can be also found under the <a href="https://github.com/bigbrodude6119/flipper-zero-evil-portal/tree/main/portals">community portals</a> directory of the same repository. Once downloaded, select one, rename it to <code>index.html</code>, and delete the old one present in the SD card folder mentioned above, before uploading the new one. There can only be one <code>index.html</code> file, but you can also rename them on the fly using Flipper Zero's built-in file manager app.</p>
<p><img alt="Index Deletion" src="https://academy.hackthebox.com/storage/modules/291/15/S1S8.gif"/></p>
<hr/>
<h1>Launching the Evil Portal</h1>
<p>Once set-up is complete, you can launch the app from your Flipper Zero with the WiFi Dev Board attached. The LED on the Flipper Zero will turn <code>GREEN</code> when the portal is running. You can choose to set the name of the Access Point (AP) from the app before starting the portal.</p>
<p><img alt="Flipper Unboxed" src="https://academy.hackthebox.com/storage/modules/291/15/S1S9.jpg"/></p>
<p>The LED colour on the WiFi Dev Board will give you hints towards the operational status of the device:</p>
<ul>
<li>
<code>BLUE</code> - Standing by</li>
<li>
<code>GREEN</code> - Running portal</li>
<li>
<code>RED</code> - Error</li>
</ul>
<p><img alt="Portal Configuration" src="https://academy.hackthebox.com/storage/modules/291/15/S1S10.gif"/></p>
<p>The <code>Set AP Name</code> function should contain a name appropriate for the chosen captive portal HTML code. If you are trying to mimic a Google Sign-In page, ensure the name of the AP itself is appropriate for the scenario. Otherwise, users might clue in that this is a malicious network.</p>
<p><img alt="Set AP Name" src="https://academy.hackthebox.com/storage/modules/291/15/S1S11.png"/></p>
<p>Connecting to the network from any device will prompt the captive portal to pop up. Depending on the quality of the clone, the user might be convinced to enter their credentials. Hitting the "Next" button will not allow them to proceed to the Internet, however. Their connection will still be blocked (mainly because the Flipper Zero can not handle doubling up as a router and forwarding all the client's traffic to the Internet), and they will simply be presented with the form again. This might raise suspicion and cause the target to disconnect from the network immediately, rendering this an ineffective way of completing a social engineering attack.</p>
<p><img alt="Evil Portal Interaction" src="https://academy.hackthebox.com/storage/modules/291/15/S1S12.gif"/></p>
<p>Regardless, in the field, you might encounter valid submissions from unaware targets. Should they have submitted anything, it will show up both on the screen of the Flipper Zero and in the logs.</p>
<p><img alt="Log View" src="https://academy.hackthebox.com/storage/modules/291/15/S1S13.png"/></p>
<p>Ensure you save the logs afterwards to retain any captured data presented on the Flipper Zero screen. This can be done by pressing the <code>Back</code> button while the portal is running, and clicking the <code>Save logs</code> option in the app.</p>
<p><img alt="Log Save" src="https://academy.hackthebox.com/storage/modules/291/15/S1S14.gif"/></p>
<p>Before launching Evil Portal attacks, you must make sure to use the appropriate HTML code for the devices you are trying to target. Legitimate captive portals adapt to the aspect ratio of the device screens they are being loaded into, so utilizing mobile-specific captive portals against desktop devices will result in a low rate of credulity from the targets.</p>
<p>You also need to make sure that the popular, legitimate captive portal you are trying to convince targets to log into is the most up-to-date version. If you decide to use any of the portals from the Flipper Zero community, keep in mind they might be out-of-date designs of the real versions.</p>
<p>As you can see, currently, the Google sign-in page looks vastly different from the example we used before:</p>
<p><img alt="Current Google Login" src="https://academy.hackthebox.com/storage/modules/291/15/S1S15.png"/></p>
<hr/>
<h1>Cloning other portals</h1>
<p>When cloning your own portal, it's important to note that large or complex web pages can cause Flipper Zero to run out of memory and crash. During testing, pages around a few kilobytes worked best, while those larger than 50 MB consistently caused crashes. When attempting to save the HTML code from the new <code>accounts.google.com</code> page for our Flipper Zero Evil Portal app, we encountered this exact issue.</p>
<p><img alt="Flipper Crash" src="https://academy.hackthebox.com/storage/modules/291/15/S1S16.png"/></p>
<p>Instead, we recommend you aim for captive portals that are more realistically used in the wild and whose HTML code is smaller in size, unlike the Google SSO login captive portal. We recommend you also keep a copy of the Flipper Zero <code>SD Card/apps_data/evil_portal</code> folder on your computer for on-the-fly modifications of the <code>index.html</code> and <code>ap.config.txt</code> files.</p>
<p>Commit to an exercise that you can easily stick to. When you travel and are met with a captive portal, whether it's a hotel, a public WiFi in the city you are visiting, a coffee shop, or anything else, try to clone it and save it in a repository for yourself or the community. Small contributions like this not only help grow the toolset you employ but also maintain your red-teaming mentality throughout your free time.</p>
<p>In the following table, we have included links to high-quality repositories containing <code>Evil Portal</code> HTML templates. Please use these as needed. We also encourage you to build your collection and exercise your knowledge in cloning websites to raise awareness of this attack vector.</p>
<table>
<thead>
<tr>
<th><strong>Link</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/kleo/evilportals">Evil Portals</a></td>
<td>Collection of portals that can be loaded into the <code>Evil Portal</code> module.</td>
</tr>
<tr>
<td><a href="https://github.com/CodyTolene/Red-Portals?tab=readme-ov-file">Red Portals</a></td>
<td>Some of the most common and realistic <code>Evil Portals</code>.</td>
</tr>
<tr>
<td><a href="https://github.com/bigbrodude6119/flipper-zero-evil-portal/tree/main/portals">Community Portals</a></td>
<td>Community-built <code>Evil Portals</code></td>
</tr>
<tr>
<td><a href="https://github.com/FlippieHacks/FlipperZeroEuropeanPortals">FlipperZeroEuropeanPortals</a></td>
<td>Over 60 portals highlighting airlines, hotels, and railway services across <code>Europe</code>.</td>
</tr>
<tr>
<td><a href="https://github.com/wifiphisher/extra-phishing-pages">Extra phishing pages</a></td>
<td>Community-built phishing scenarios for <code>Wifiphisher</code>.</td>
</tr>
</tbody>
</table>
<hr/>
<h1>Loot gathering</h1>
<p>When you are finished running the attack, ensure you hit the <code>Stop portal</code> button, and wait for the status LED on the WiFi Dev Board to turn <code>BLUE</code>. Ensure one more time that you also click the <code>Save logs</code> button to retain all the saved credentials.</p>
<p>You may now disconnect the WiFi Dev Board from the Flipper Zero, and connect the latter to your computer for log collection. Using the qFlipper, navigate to <code>SD Card/apps_data/evil_potal/logs/</code> and download all of the logs by right-clicking on them and selecting <code>Download</code>. These logs will contain any of the information inputted by the targets into the Evil Portal during its operation.</p>
<p><img alt="Log Download" src="https://academy.hackthebox.com/storage/modules/291/15/S1S17.png"/></p>
<hr/>
<h2>Closing Thoughts</h2>
<p>Attacking Wi-Fi networks using Rogue Access Points or Evil Twins is a crucial skill for evaluating the security posture of clients and employees against social engineering attacks. The Evil Twin attack remains a powerful vector for compromising Wi-Fi networks, even as protocols like WPA3 and WPA-Enterprise continue to evolve. By leveraging rogue access points, captive portals, and advanced MiTM strategies, attackers can deceive clients and harvest sensitive credentials. Understanding these attack methods is critical not only for offensive security assessments but also for reinforcing defenses. Security professionals must stay vigilant against these evolving threats to better protect networks and educate users on safe Wi-Fi practices.</p>
<p>As attackers evolve, so must defenders. Training employees against such attacks, enforcing certificate validation for enterprise networks, and regularly auditing Wi-Fi networks with wireless IDS such as <a href="https://www.nzyme.org/">Nzyme</a> are essential steps to mitigate these threats. By understanding how Evil Twin attacks work, we become better equipped to defend against them and build more resilient wireless infrastructures. Continuous learning and proactive defense strategies are vital in staying ahead of evolving attack vectors, ensuring secure and reliable wireless environments.</p>
