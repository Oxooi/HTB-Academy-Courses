
<h1>Advanced Settings</h1>
<hr/>
<p>We can configure a number of advanced settings for Nessus and its scans, like scan policies, plugins, and credentials, all of which we will cover in this section.</p>
<hr/>
<h2>Scan Policies</h2>
<p>Nessus gives us the option to create scan policies. Essentially these are customized scans that allow us to define specific scan options, save the policy configuration, and have them available to us under <code>Scan Templates</code> when creating a new scan. This gives us the ability to create targeted scans for any number of scenarios, such as a slower, more evasive scan, a web-focused scan, or a scan for a particular client using one or several sets of credentials. Scan policies can be imported from other Nessus scanners or exported to be later imported into another Nessus scanner.</p>
<p><img alt="Policies page with options to import or create a new policy. No policies created yet." src="https://academy.hackthebox.com/storage/modules/108/nessus/nessus_policies.png"/></p>
<hr/>
<h2>Creating a Scan Policy</h2>
<p>To create a scan policy, we can click on the <code>New Policy</code> button in the top right, and we will be presented with the list of pre-configured scans. We can choose a scan, such as the <code>Basic Network Scan</code>, then customize it, or we can create our own. We will choose <code>Advanced Scan</code> to create a fully customized scan with no pre-configured recommendations built-in.</p>
<p>After choosing the scan type as our base, we can give the scan policy a name and a description if needed:
<img alt="New Policy/Advanced Scan page with 'HTB_Policy' as the policy name. Options to save or cancel." src="https://academy.hackthebox.com/storage/modules/108/nessus/policy.png"/></p>
<p>From here, we can configure settings, add in any necessary credentials, and specify any compliance standards to run the scan against. We can also choose to enable or disable entire <a href="https://docs.tenable.com/nessus/Content/Plugins.htm">plugin</a> families or individual plugins.</p>
<p>Once we have finished customizing the scan, we can click on <code>Save</code>, and the newly created policy will appear in the polices list. From here on, when we go to create a new scan, there will be a new tab named <code>User Defined</code> under <code>Scan Templates</code> that will show all of our custom scan policies:
<img alt="Scan Templates page showing 'HTB_Policy' as a user-defined policy under Nessus Essentials." src="https://academy.hackthebox.com/storage/modules/108/nessus/htb_policydefined.png"/></p>
<hr/>
<h2>Nessus Plugins</h2>
<p>Nessus works with plugins written in the <a href="https://en.wikipedia.org/wiki/Nessus_Attack_Scripting_Language">Nessus Attack Scripting Language (NASL)</a> and can target new vulnerabilities and CVEs. These plugins contain information such as the vulnerability name, impact, remediation, and a way to test for the presence of a particular issue.</p>
<p>Plugins are rated by severity level: <code>Critical</code>, <code>High</code>, <code>Medium</code>, <code>Low</code>, <code>Info</code>. At the time of this writing Tenable has published <code>145,973</code> plugins that cover <code>58,391</code> CVE IDs and <code>30,696</code> <a href="https://en.wikipedia.org/wiki/Bugtraq">Bugtraq</a> IDs. A searchable database of all published plugins is on the <a href="https://www.tenable.com/plugins">Tenable website</a>.</p>
<p>The <code>Plugins</code> tab provides more information on a particular detection, including mitigation. When conducting recurring scans, there may be a vulnerability/detection that, upon further examination, is not considered to be an issue. For example, Microsoft DirectAccess (a technology that provides internal network connectivity to clients over the Internet) allows insecure and null cipher suites. The below scan performed with <code>sslscan</code> shows an example of insecure and null cipher suites:</p>
<pre><code class="language-shell-session">[!bash!]$ sslscan example.com

&lt;SNIP&gt;

Preferred TLSv1.0  128 bits  ECDHE-RSA-AES128-SHA          Curve 25519 DHE 253
Accepted  TLSv1.0  256 bits  ECDHE-RSA-AES256-SHA          Curve 25519 DHE 253
Accepted  TLSv1.0  128 bits  DHE-RSA-AES128-SHA            DHE 2048 bits
Accepted  TLSv1.0  256 bits  DHE-RSA-AES256-SHA            DHE 2048 bits
Accepted  TLSv1.0  128 bits  AES128-SHA                   
Accepted  TLSv1.0  256 bits  AES256-SHA                   

&lt;SNIP&gt;
</code></pre>
<p>However, this is by design. SSL/TLS is not <a href="https://directaccess.richardhicks.com/2014/09/23/directaccess-ip-https-ssl-and-tls-insecure-cipher-suites/">required</a> in this case, and implementing it would result in a negative performance impact. To exclude this false positive from the scan results while keeping the detection active for other hosts, we can create a plugin rule:
<img alt="Plugin Rules page with options to create, edit, and delete rules. No plugin rules created yet." src="https://academy.hackthebox.com/storage/modules/108/nessus/plugin_rules.png"/></p>
<p>Under the <code>Resources</code> section, we can select <code>Plugin Rules</code>. In the new plugin rule, we input the host to be excluded, along with the Plugin ID for Microsoft DirectAccess, and specify the action to be performed as <code>Hide this result</code>:
<img alt="New Rule form with fields for Host, Plugin ID, Expiration Date, and Severity dropdown. Options to add or cancel." src="https://academy.hackthebox.com/storage/modules/108/nessus/new-rule.png"/></p>
<p>We may also want to exclude certain issues from our scan results, such as plugins for issues that are not directly exploitable (e.g., <a href="https://www.tenable.com/plugins/nessus/57582">SSL Self-Signed Certificate</a>). We can do this by specifying the plugin ID and host(s) to be excluded:
<img alt="New Rule form with fields: Host set to 'yourhost.com', Plugin ID 57582, optional Expiration Date, and Severity set to 'Hide this result'. Options to add or cancel." src="https://academy.hackthebox.com/storage/modules/108/nessus/plugins2.png"/></p>
<hr/>
<h2>Scanning with Credentials</h2>
<p>Nessus also supports credentialed scanning and provides a lot of flexibility by supporting LM/NTLM hashes, Kerberos authentication, and password authentication.</p>
<p>Credentials can be configured for host-based authentication via SSH with a password, public key, certificate, or Kerberos-based authentication. It can also be configured for Windows host-based authentication with a password, Kerberos, LM hash, or NTLM hash:
<img alt="Windows credentials settings with options for authentication method, username, password, and domain. Global settings include 'Never send credentials in the clear' and 'Do not use NTLMv1 authentication' checked." src="https://academy.hackthebox.com/storage/modules/108/nessus/creds.png"/></p>
<p>Nessus also supports authentication for a variety of databases types including Oracle, PostgreSQL, DB2, MySQL, SQL Server, MongoDB, and Sybase:
<img alt="Database credentials settings with SQL Server, password authentication, username 'dba', port 1433, and Windows auth type." src="https://academy.hackthebox.com/storage/modules/108/nessus/db_creds.png"/></p>
<div class="card bg-light">
<div class="card-body">
<p class="mb-0"><b>Note:</b> To run a credentialed scan on the target, use the following credentials: <code>htb-student_adm</code>:<code>HTB_@cademy_student!</code> for Linux, and <code>administrator</code>:<code>Academy_VA_adm1!</code> for Windows. These scans have already been set up in the Nessus target to save you time.</p>
</div>
</div>
<p>In addition to that, Nessus can perform plaintext authentication to services such as FTP, HTTP, IMAP, IPMI, Telnet, and more:
<img alt="HTTP credentials settings with login form method, username 'admin', login page '/login.php', and submission page '/process_login.php'." src="https://academy.hackthebox.com/storage/modules/108/nessus/plaintext_auth.png"/></p>
<p>Finally, we can check the Nessus output to confirm whether the authentication to the target application or service with the supplied credentials was successful:
<img alt="Info: Microsoft SQL Server login possible. Description: Nessus logged into MS SQL server using credentials. Output: Credentialed checks enabled for MSSQL on port 1433, version 14.0.1000.0." src="https://academy.hackthebox.com/storage/modules/108/nessus/sqlserv.png"/></p>
